<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema Barbearia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&amp;family=Inter:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/material.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/selection/active-line.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      font-family: 'Inter', sans-serif;
    }
    
    .title-font {
      font-family: 'Bebas Neue', sans-serif;
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 12px;
      color: white;
      font-weight: 700;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
    }
    
    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 0.6s linear infinite;
      display: inline-block;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .card {
      background: linear-gradient(135deg, #18181b 0%, #0a0a0a 100%);
      border: 1px solid rgba(82, 82, 91, 0.2);
      transition: all 0.3s ease;
    }

    .card:hover {
      border-color: rgba(82, 82, 91, 0.4);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    #app {
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .tab-content {
      will-change: auto;
    }

    ::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }

    ::-webkit-scrollbar-track {
      background: #18181b;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      border-radius: 10px;
      border: 2px solid #18181b;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
    }

    ::-webkit-scrollbar-corner {
      background: #18181b;
    }

    * {
      scrollbar-width: thin;
      scrollbar-color: #10b981 #18181b;
    }

    .history-item, .cost-item, .service-item {
      contain: layout style paint;
    }

    .CodeMirror {
      height: 600px;
      font-size: 14px;
      border-radius: 12px;
      border: 1px solid rgba(82, 82, 91, 0.3);
    }

    .editor-toolbar {
      background: #18181b;
      border: 1px solid rgba(82, 82, 91, 0.3);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 16px;
    }

    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .loading-spinner {
      border: 4px solid rgba(16, 185, 129, 0.2);
      border-top-color: #10b981;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 0.8s linear infinite;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-black text-gray-100"><!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
   <div class="loading-spinner"></div>
   <p class="text-white text-xl font-bold mt-6">Carregando dados...</p>
  </div>
  <div id="app" class="h-full w-full"><!-- Header -->
   <header class="bg-gradient-to-r from-zinc-950 to-black border-b border-zinc-800 px-6 py-5">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
     <div>
      <h1 class="title-font text-4xl text-green-400 tracking-wider">CAIXA BARBEIRO</h1>
      <p class="text-sm text-gray-400 mt-1">CNPJ: 32.554.785/0001-30</p>
     </div>
     <div class="text-right">
      <p id="header-date" class="text-lg font-bold text-green-400"></p>
      <p id="header-time" class="text-2xl font-black text-white title-font tracking-wider"></p>
     </div>
    </div>
   </header><!-- Tabs -->
   <nav class="bg-zinc-950 border-b border-zinc-800">
    <div class="max-w-7xl mx-auto px-4">
     <div class="flex gap-1 overflow-x-auto"><button class="tab-btn active px-3 py-3 font-bold text-xs flex-1 whitespace-nowrap text-green-400 border-b-2 border-green-400" data-tab="registro">üìù REGISTRO</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="historico">üìã HIST√ìRICO</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="relatorios">üìä RELAT√ìRIOS</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="extrato">üí∞ EXTRATO</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="profissionais">üë§ PROFISSIONAIS</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="servicos">‚úÇÔ∏è SERVI√áOS</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="custos">üíµ CUSTOS</button>
     </div>
    </div>
   </nav><!-- Main Content -->
   <main class="max-w-7xl mx-auto px-4 py-8"><!-- TAB: REGISTRO -->
    <div id="tab-registro" class="tab-content">
     <div class="card rounded-2xl p-6 mb-6">
      <h2 class="text-2xl font-bold text-green-400 mb-6">üìù Registro R√°pido</h2><!-- Selecionar Profissional, Data e Hor√°rio -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
       <div><label for="quick-prof" class="block text-sm font-bold mb-3 text-gray-300">PROFISSIONAL:</label> <select id="quick-prof" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-lg font-semibold focus:border-green-500 focus:outline-none"> <option value="">Selecione o profissional</option> <option value="THIAGO">üëë THIAGO (Propriet√°rio)</option> </select>
       </div>
       <div><label for="quick-date" class="block text-sm font-bold mb-3 text-gray-300">DATA DO ATENDIMENTO:</label> <input type="date" id="quick-date" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-lg font-semibold focus:border-green-500 focus:outline-none">
       </div>
       <div><label for="quick-time" class="block text-sm font-bold mb-3 text-gray-300">HOR√ÅRIO:</label> <input type="time" id="quick-time" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-lg font-semibold focus:border-green-500 focus:outline-none">
       </div>
      </div><!-- Seletor de Servi√ßos -->
      <div class="mb-6"><label for="service-selector" class="block text-sm font-bold mb-3 text-gray-300">ADICIONAR SERVI√áO:</label>
       <div class="flex gap-3"><select id="service-selector" class="flex-1 bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-lg font-semibold focus:border-green-500 focus:outline-none"> <option value="">Selecione um servi√ßo</option> </select> <button id="add-service-btn" class="btn-primary text-white font-black px-8 py-3 rounded-xl whitespace-nowrap"> ‚ûï ADICIONAR </button>
       </div>
      </div><!-- Servi√ßos Selecionados -->
      <div id="selected-services-container" class="mb-6 hidden"><label class="block text-sm font-bold mb-3 text-gray-300">SERVI√áOS SELECIONADOS:</label>
       <div id="selected-services" class="bg-zinc-900 rounded-xl p-4 space-y-2"></div>
       <div class="mt-4 flex items-center justify-between bg-zinc-900 rounded-xl p-4"><span class="text-lg font-bold text-gray-300">TOTAL:</span> <span id="total-value" class="text-2xl font-black text-green-400">R$ 0,00</span>
       </div>
      </div><!-- Bot√µes de A√ß√£o -->
      <div class="flex gap-3"><button id="save-quick-btn" class="flex-1 btn-primary text-white font-black py-4 rounded-xl text-lg shadow-lg"> üíæ SALVAR ATENDIMENTO </button> <button id="clear-quick-btn" class="bg-zinc-800 hover:bg-zinc-700 text-white font-bold px-6 py-4 rounded-xl"> üóëÔ∏è LIMPAR </button>
      </div>
     </div>
    </div><!-- TAB: HIST√ìRICO -->
    <div id="tab-historico" class="tab-content hidden">
     <div class="card rounded-2xl p-6 mb-6">
      <h2 class="text-2xl font-bold text-green-400 mb-6">üîç Filtros</h2>
      <div class="flex gap-4">
       <div class="flex-1"><label for="filter-date" class="block text-sm font-bold mb-2 text-gray-300">Filtrar por Data:</label> <input type="date" id="filter-date" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2 text-white focus:border-green-500 focus:outline-none">
       </div>
       <div class="flex items-end"><button id="clear-filters-btn" class="bg-zinc-800 hover:bg-zinc-700 text-white font-bold px-6 py-2 rounded-xl whitespace-nowrap"> üóëÔ∏è LIMPAR FILTRO </button>
       </div>
      </div>
     </div>
     <div class="card rounded-2xl p-6">
      <div class="flex items-center justify-between mb-6">
       <h2 class="text-2xl font-bold text-green-400">üìã Hist√≥rico de Transa√ß√µes</h2>
       <div class="flex items-center gap-4">
        <p class="text-sm text-gray-400"><span id="history-count">0</span> registros</p>
       </div>
      </div>
      <div id="history-list" class="space-y-3"></div>
     </div>
    </div><!-- TAB: RELAT√ìRIOS -->
    <div id="tab-relatorios" class="tab-content hidden">
     <div class="card rounded-2xl p-6 mb-6">
      <h2 class="text-2xl font-bold text-green-400 mb-6">üìä Filtros de Relat√≥rio</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
       <div><label for="report-month" class="block text-sm font-bold mb-2 text-gray-300">M√™s:</label> <select id="report-month" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2 text-white focus:border-green-500 focus:outline-none"> <option value="01">Janeiro</option> <option value="02">Fevereiro</option> <option value="03">Mar√ßo</option> <option value="04">Abril</option> <option value="05">Maio</option> <option value="06">Junho</option> <option value="07">Julho</option> <option value="08">Agosto</option> <option value="09">Setembro</option> <option value="10">Outubro</option> <option value="11">Novembro</option> <option value="12">Dezembro</option> </select>
       </div>
       <div><label for="report-year" class="block text-sm font-bold mb-2 text-gray-300">Ano:</label> <input type="number" id="report-year" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2 text-white focus:border-green-500 focus:outline-none">
       </div>
      </div>
     </div>
     <div id="reports-container" class="space-y-6"></div>
    </div><!-- TAB: EXTRATO -->
    <div id="tab-extrato" class="tab-content hidden">
     <div class="card rounded-2xl p-6 mb-6">
      <h2 class="text-2xl font-bold text-green-400 mb-6">üìÖ Filtro de Per√≠odo</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label for="extrato-year" class="block text-sm font-bold mb-2 text-gray-300">Ano:</label> <input type="number" id="extrato-year" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2 text-white focus:border-green-500 focus:outline-none">
       </div>
       <div><label for="extrato-month" class="block text-sm font-bold mb-2 text-gray-300">M√™s (opcional):</label> <select id="extrato-month" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2 text-white focus:border-green-500 focus:outline-none"> <option value="">Anual (todos os meses)</option> <option value="01">Janeiro</option> <option value="02">Fevereiro</option> <option value="03">Mar√ßo</option> <option value="04">Abril</option> <option value="05">Maio</option> <option value="06">Junho</option> <option value="07">Julho</option> <option value="08">Agosto</option> <option value="09">Setembro</option> <option value="10">Outubro</option> <option value="11">Novembro</option> <option value="12">Dezembro</option> </select>
       </div>
      </div>
     </div>
     <div id="extrato-container" class="space-y-6"></div>
    </div><!-- TAB: PROFISSIONAIS -->
    <div id="tab-profissionais" class="tab-content hidden">
     <div class="card rounded-2xl p-6 mb-6">
      <h2 class="text-2xl font-bold text-green-400 mb-4">üëë Propriet√°rio</h2>
      <div class="bg-zinc-900 rounded-xl p-6">
       <p class="text-3xl font-black text-green-400">THIAGO</p>
       <p class="text-gray-400 mt-2">Recebe 50% de comiss√£o dos colaboradores</p>
      </div>
     </div>
     <div class="card rounded-2xl p-6">
      <h2 class="text-2xl font-bold text-green-400 mb-4">üë§ Colaboradores</h2>
      <form id="prof-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"><input type="text" id="prof-name" required placeholder="Nome do colaborador" class="bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 font-semibold text-white placeholder-gray-500 focus:border-green-500 focus:outline-none"> <input type="number" id="prof-commission" required placeholder="Comiss√£o %" min="0" max="100" class="bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 font-semibold text-white placeholder-gray-500 focus:border-green-500 focus:outline-none"> <button type="submit" class="btn-primary text-white font-black py-3 rounded-xl">ADICIONAR</button>
      </form>
      <div id="prof-list" class="space-y-3"></div>
     </div>
    </div><!-- TAB: SERVI√áOS -->
    <div id="tab-servicos" class="tab-content hidden">
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="card rounded-2xl p-6">
       <h2 class="text-2xl font-bold text-green-400 mb-4">‚úÇÔ∏è Cadastrar Servi√ßo</h2>
       <form id="service-form" class="space-y-4"><input type="text" id="service-name" required placeholder="Nome do servi√ßo" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 font-semibold text-white placeholder-gray-500 focus:border-green-500 focus:outline-none"> <input type="number" id="service-value" required placeholder="Valor R$" step="0.01" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 font-semibold text-white placeholder-gray-500 focus:border-green-500 focus:outline-none"> <button type="submit" class="w-full btn-primary text-white font-black py-3 rounded-xl">CADASTRAR</button>
       </form>
       <div class="mt-6 pt-6 border-t border-zinc-700"><button id="import-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-3 rounded-xl"> üì• IMPORTAR SERVI√áOS PADR√ÉO </button>
       </div>
      </div>
      <div class="card rounded-2xl p-6">
       <h2 class="text-2xl font-bold text-green-400 mb-4">Lista de Servi√ßos (<span id="service-count">0</span>)</h2>
       <div id="service-list" class="space-y-2 max-h-96 overflow-y-auto"></div>
      </div>
     </div>
    </div><!-- TAB: CUSTOS -->
    <div id="tab-custos" class="tab-content hidden">
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="card rounded-2xl p-6">
       <h2 class="text-2xl font-bold text-green-400 mb-4">üíµ Registrar Custo</h2>
       <form id="cost-form" class="space-y-4"><input type="date" id="cost-date" required class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-white focus:border-green-500 focus:outline-none"> <input type="text" id="cost-desc" required placeholder="Descri√ß√£o do custo" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:border-green-500 focus:outline-none"> <input type="number" id="cost-value" required placeholder="Valor R$" step="0.01" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 font-semibold text-white placeholder-gray-500 focus:border-green-500 focus:outline-none"> <button type="submit" class="w-full btn-primary text-white font-black py-3 rounded-xl">REGISTRAR CUSTO</button>
       </form>
      </div>
      <div class="card rounded-2xl p-6">
       <h2 class="text-2xl font-bold text-green-400 mb-4">Custos Recentes</h2>
       <div id="cost-list" class="space-y-2 max-h-96 overflow-y-auto"></div>
      </div>
     </div>
    </div>
   </main><!-- Bot√£o Flutuante Editor --> <button id="floating-editor-btn" class="fixed bottom-6 right-6 bg-gradient-to-br from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white w-16 h-16 rounded-full shadow-2xl flex items-center justify-center text-3xl z-50 transition-all hover:scale-110 hover:rotate-90" title="Abrir Editor de C√≥digo"> ‚öôÔ∏è </button> <!-- Modal Editor -->
   <div id="editor-modal" class="hidden fixed inset-0 z-[60] bg-black/90 backdrop-blur-sm overflow-y-auto">
    <div class="min-h-screen px-4 py-8">
     <div class="max-w-7xl mx-auto">
      <div class="bg-zinc-900 rounded-2xl border border-zinc-700 overflow-hidden"><!-- Header do Modal -->
       <div class="bg-gradient-to-r from-purple-900 to-blue-900 p-6 flex items-center justify-between border-b border-zinc-700">
        <div>
         <h2 class="text-3xl font-bold text-white title-font">üîß EDITOR DE C√ìDIGO</h2>
         <p class="text-sm text-gray-300 mt-1">Editor avan√ßado com suporte a JavaScript, HTML, CSS e JSON</p>
        </div><button id="close-editor-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold px-6 py-3 rounded-xl transition-all hover:scale-105"> ‚úñÔ∏è FECHAR </button>
       </div><!-- Conte√∫do do Editor -->
       <div class="p-6">
        <div class="mb-6">
         <div class="flex items-center justify-between mb-6">
          <div class="flex gap-3"><button id="export-code-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-4 py-2 rounded-xl text-sm"> üì• EXPORTAR C√ìDIGO </button> <button id="format-code-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold px-4 py-2 rounded-xl text-sm"> ‚ú® FORMATAR </button>
          </div>
         </div><!-- Barra de Ferramentas -->
         <div class="editor-toolbar flex items-center gap-4 flex-wrap">
          <div class="flex items-center gap-2"><label for="editor-language" class="text-sm font-bold text-gray-300">Linguagem:</label> <select id="editor-language" class="bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white text-sm focus:border-green-500 focus:outline-none"> <option value="javascript">JavaScript</option> <option value="htmlmixed">HTML</option> <option value="css">CSS</option> <option value="application/json">JSON</option> </select>
          </div><button id="load-page-code-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold px-4 py-2 rounded-lg text-sm"> üìÑ CARREGAR C√ìDIGO DA P√ÅGINA </button>
          <div class="flex items-center gap-2"><label for="editor-theme" class="text-sm font-bold text-gray-300">Tema:</label> <select id="editor-theme" class="bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white text-sm focus:border-green-500 focus:outline-none"> <option value="dracula">Dracula</option> <option value="monokai">Monokai</option> <option value="material">Material</option> <option value="default">Claro</option> </select>
          </div>
          <div class="flex items-center gap-2"><label for="editor-fontsize" class="text-sm font-bold text-gray-300">Tamanho:</label> <select id="editor-fontsize" class="bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-white text-sm focus:border-green-500 focus:outline-none"> <option value="12">12px</option> <option value="14" selected>14px</option> <option value="16">16px</option> <option value="18">18px</option> <option value="20">20px</option> </select>
          </div><button id="toggle-linenumbers-btn" class="bg-zinc-700 hover:bg-zinc-600 text-white font-bold px-3 py-2 rounded-lg text-sm"> üìÑ Linhas: ON </button>
          <div class="flex-1"></div>
          <div class="flex items-center gap-2 text-sm text-gray-400"><span>Linhas: <span id="editor-lines">0</span></span> <span>|</span> <span>Caracteres: <span id="editor-chars">0</span></span>
          </div>
         </div><!-- Editor de C√≥digo -->
         <div class="mb-4"><textarea id="code-editor"></textarea>
         </div><!-- Bot√µes de A√ß√£o -->
         <div class="grid grid-cols-1 md:grid-cols-3 gap-4"><button id="clear-editor-btn" class="bg-zinc-700 hover:bg-zinc-600 text-white font-bold py-3 rounded-xl"> üóëÔ∏è LIMPAR EDITOR </button> <button id="save-snippet-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl"> üíæ SALVAR SNIPPET </button> <button id="run-code-btn" class="btn-primary text-white font-black py-3 rounded-xl"> ‚ñ∂Ô∏è EXECUTAR C√ìDIGO </button>
         </div><!-- Console de Sa√≠da -->
         <div class="mt-6">
          <div class="flex items-center justify-between mb-3">
           <h3 class="text-lg font-bold text-green-400">üìü Console</h3><button id="clear-console-btn" class="bg-zinc-700 hover:bg-zinc-600 text-white font-bold px-3 py-2 rounded-lg text-sm"> üóëÔ∏è LIMPAR </button>
          </div>
          <div id="console-output" class="bg-zinc-950 border border-zinc-700 rounded-xl p-4 font-mono text-sm min-h-[200px] max-h-[400px] overflow-y-auto"></div>
         </div>
        </div><!-- Snippets Salvos -->
        <div class="card rounded-2xl p-6">
         <h3 class="text-2xl font-bold text-green-400 mb-4">üìö Snippets Salvos (LocalStorage)</h3>
         <div id="snippets-list" class="space-y-2"></div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Modal de Confirma√ß√£o -->
   <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
    <div class="bg-zinc-800 rounded-2xl p-6 max-w-md w-full mx-4 border border-zinc-700">
     <h3 class="text-xl font-bold text-red-400 mb-4">‚ö†Ô∏è Confirmar Exclus√£o</h3>
     <p id="modal-text" class="text-gray-300 mb-6"></p>
     <div class="flex gap-3"><button id="modal-cancel" class="flex-1 bg-zinc-700 hover:bg-zinc-600 text-white font-bold py-3 rounded-xl">CANCELAR</button> <button id="modal-confirm" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl">EXCLUIR</button>
     </div>
    </div>
   </div><!-- Modal de Salvar Snippet -->
   <div id="snippet-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
    <div class="bg-zinc-800 rounded-2xl p-6 max-w-md w-full mx-4 border border-zinc-700">
     <h3 class="text-xl font-bold text-green-400 mb-4">üíæ Salvar Snippet</h3><input type="text" id="snippet-name" placeholder="Nome do snippet" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-white mb-4 focus:border-green-500 focus:outline-none">
     <div class="flex gap-3"><button id="snippet-modal-cancel" class="flex-1 bg-zinc-700 hover:bg-zinc-600 text-white font-bold py-3 rounded-xl">CANCELAR</button> <button id="snippet-modal-save" class="flex-1 btn-primary text-white font-bold py-3 rounded-xl">SALVAR</button>
     </div>
    </div>
   </div>
  </div>
  <script>
    // ====================================
    // CONFIGURA√á√ÉO DA API GOOGLE SHEETS
    // ====================================
    const API_URL = 'https://script.google.com/macros/s/AKfycbwcwmkZYIpAyqwPej-Myb4JI8mc6QUovHQnTJBQM9mJej9eAfVVxncNT_aJPURoy06t/exec';
    const TOKEN = '753826';

    // ====================================
    // FUN√á√ïES DE API
    // ====================================
    
    // GET - Listar transa√ß√µes
    async function apiGetListar() {
      try {
        const response = await fetch(`${API_URL}?acao=listar&token=${TOKEN}`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('Erro ao listar:', error);
        return { ok: false, items: [] };
      }
    }

    // POST - Adicionar ou deletar
    async function apiPost(acao, payload) {
      try {
        const body = {
          token: TOKEN,
          acao: acao,
          ...payload
        };
        
        // Google Apps Script aceita POST como query params em alguns casos
        const params = new URLSearchParams(body);
        
        const response = await fetch(`${API_URL}?${params.toString()}`, {
          method: 'POST',
          mode: 'no-cors' // Importante para APIs do Google
        });
        
        // Com no-cors, n√£o conseguimos ler o response, mas se n√£o der erro HTTP, funcionou
        return { ok: true };
      } catch (error) {
        console.error('Erro no POST:', error);
        return { ok: false, error: error.message };
      }
    }

    // Adicionar transa√ß√£o
    async function adicionarTransacao(obj) {
      return await apiPost('adicionar', obj);
    }

    // Deletar transa√ß√£o
    async function deletarTransacao(id) {
      return await apiPost('deletar', { id: id });
    }

    // ====================================
    // ESTADO GLOBAL
    // ====================================
    const state = {
      services: [],
      professionals: [],
      transacoes: [], // Todas as transa√ß√µes da API
      selectedServices: [],
      deleteCallback: null,
      filterDate: null,
      snippets: []
    };

    // CodeMirror Instance
    let editorInstance = null;

    // ====================================
    // FUN√á√ïES DE UI
    // ====================================
    
    // Toast
    function toast(msg, type = 'success') {
      const div = document.createElement('div');
      div.className = `toast ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
      div.textContent = msg;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 3000);
    }

    // Loading Overlay
    function showLoading() {
      document.getElementById('loading-overlay').classList.remove('hidden');
    }

    function hideLoading() {
      document.getElementById('loading-overlay').classList.add('hidden');
    }

    // Modal
    function showModal(msg, callback) {
      document.getElementById('modal-text').textContent = msg;
      document.getElementById('modal').classList.remove('hidden');
      state.deleteCallback = callback;
    }

    document.getElementById('modal-cancel').addEventListener('click', () => {
      document.getElementById('modal').classList.add('hidden');
      state.deleteCallback = null;
    });

    document.getElementById('modal-confirm').addEventListener('click', () => {
      if (state.deleteCallback) state.deleteCallback();
      document.getElementById('modal').classList.add('hidden');
      state.deleteCallback = null;
    });

    // ====================================
    // CARREGAR DADOS DA API
    // ====================================
    async function carregarDados() {
      showLoading();
      
      const result = await apiGetListar();
      
      if (result.ok && result.items) {
        state.transacoes = result.items;
        console.log('‚úÖ Dados carregados:', state.transacoes.length, 'transa√ß√µes');
      } else {
        console.error('‚ùå Erro ao carregar dados');
        toast('Erro ao carregar dados!', 'error');
      }
      
      // Carregar dados do LocalStorage
      carregarLocalStorage();
      
      hideLoading();
      render();
    }

    // ====================================
    // LOCALSTORAGE (Servi√ßos, Profissionais, Snippets)
    // ====================================
    function salvarLocalStorage() {
      localStorage.setItem('barbeariaServices', JSON.stringify(state.services));
      localStorage.setItem('barbeariaProfessionals', JSON.stringify(state.professionals));
      localStorage.setItem('barbeariaSnippets', JSON.stringify(state.snippets));
    }

    function carregarLocalStorage() {
      const services = localStorage.getItem('barbeariaServices');
      const professionals = localStorage.getItem('barbeariaProfessionals');
      const snippets = localStorage.getItem('barbeariaSnippets');
      
      if (services) state.services = JSON.parse(services);
      if (professionals) state.professionals = JSON.parse(professionals);
      if (snippets) state.snippets = JSON.parse(snippets);
    }

    // ====================================
    // RENDER
    // ====================================
    function render() {
      renderServiceSelector();
      renderProfList();
      renderServiceList();
      updateSelects();
      
      const activeTab = document.querySelector('.tab-btn.active')?.dataset.tab;
      if (activeTab === 'historico') renderHistory();
      if (activeTab === 'relatorios') renderReports();
      if (activeTab === 'extrato') renderExtrato();
      if (activeTab === 'custos') renderCostList();
    }

    // Render Seletor de Servi√ßos
    function renderServiceSelector() {
      const selector = document.getElementById('service-selector');
      if (!selector) return;
      
      if (state.services.length === 0) {
        selector.innerHTML = '<option value="">Nenhum servi√ßo cadastrado</option>';
        return;
      }

      selector.innerHTML = '<option value="">Selecione um servi√ßo</option>' + 
        state.services
          .sort((a, b) => a.name.localeCompare(b.name))
          .map(s => `<option value="${s.id}">${s.name} - R$ ${s.value.toFixed(2)}</option>`)
          .join('');
    }

    // Adicionar servi√ßo selecionado
    document.getElementById('add-service-btn').addEventListener('click', () => {
      const selector = document.getElementById('service-selector');
      const serviceId = selector.value;
      
      if (!serviceId) {
        toast('Selecione um servi√ßo!', 'error');
        return;
      }
      
      const service = state.services.find(s => s.id === serviceId);
      if (!service) return;
      
      const exists = state.selectedServices.find(s => s.id === serviceId);
      if (exists) {
        exists.qty++;
      } else {
        state.selectedServices.push({...service, qty: 1});
      }
      
      selector.value = '';
      renderSelectedServices();
    });

    // Render Servi√ßos Selecionados
    function renderSelectedServices() {
      const container = document.getElementById('selected-services-container');
      const list = document.getElementById('selected-services');
      const totalEl = document.getElementById('total-value');

      if (state.selectedServices.length === 0) {
        container.classList.add('hidden');
        return;
      }

      container.classList.remove('hidden');
      
      let total = 0;
      list.innerHTML = state.selectedServices.map(s => {
        const subtotal = s.value * s.qty;
        total += subtotal;
        return `
          <div class="flex items-center justify-between bg-zinc-800 rounded-lg p-3">
            <div class="flex-1">
              <p class="font-bold">${s.name}</p>
              <p class="text-sm text-gray-400">R$ ${s.value.toFixed(2)} x ${s.qty} = R$ ${subtotal.toFixed(2)}</p>
            </div>
            <div class="flex items-center gap-3">
              <button class="qty-btn bg-zinc-700 hover:bg-zinc-600 w-8 h-8 rounded-lg font-bold" data-id="${s.id}" data-action="minus">-</button>
              <span class="font-bold text-lg w-8 text-center">${s.qty}</span>
              <button class="qty-btn bg-zinc-700 hover:bg-zinc-600 w-8 h-8 rounded-lg font-bold" data-id="${s.id}" data-action="plus">+</button>
              <button class="remove-btn bg-red-600 hover:bg-red-700 px-3 py-1 rounded-lg font-bold text-sm" data-id="${s.id}">Remover</button>
            </div>
          </div>
        `;
      }).join('');

      totalEl.textContent = `R$ ${total.toFixed(2)}`;

      list.querySelectorAll('.qty-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          const action = btn.dataset.action;
          const service = state.selectedServices.find(s => s.id === id);
          
          if (action === 'plus') service.qty++;
          else if (action === 'minus' && service.qty > 1) service.qty--;
          
          renderSelectedServices();
        });
      });

      list.querySelectorAll('.remove-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          state.selectedServices = state.selectedServices.filter(s => s.id !== id);
          renderSelectedServices();
        });
      });
    }

    // Salvar Atendimento
    document.getElementById('save-quick-btn').addEventListener('click', async () => {
      const prof = document.getElementById('quick-prof').value;
      const dateInput = document.getElementById('quick-date').value;
      const timeInput = document.getElementById('quick-time').value;
      
      if (!prof || !dateInput || !timeInput || state.selectedServices.length === 0) {
        toast('Preencha todos os campos!', 'error');
        return;
      }

      const btn = document.getElementById('save-quick-btn');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner mx-auto"></div>';

      for (const service of state.selectedServices) {
        for (let i = 0; i < service.qty; i++) {
          const transacao = {
            data: dateInput,
            tipo: 'entrada',
            valor: service.value,
            categoria: service.name,
            descricao: `Profissional: ${prof} - Hor√°rio: ${timeInput}`
          };
          
          const result = await adicionarTransacao(transacao);
          
          if (!result.ok) {
            toast('Erro ao salvar atendimento!', 'error');
            btn.disabled = false;
            btn.textContent = 'üíæ SALVAR ATENDIMENTO';
            return;
          }
        }
      }

      toast('‚úÖ Atendimentos salvos!');
      state.selectedServices = [];
      renderSelectedServices();
      
      btn.disabled = false;
      btn.textContent = 'üíæ SALVAR ATENDIMENTO';
      
      await carregarDados();
    });

    // Limpar Sele√ß√£o
    document.getElementById('clear-quick-btn').addEventListener('click', () => {
      state.selectedServices = [];
      renderSelectedServices();
    });

    // ====================================
    // HIST√ìRICO
    // ====================================
    function renderHistory() {
      const list = document.getElementById('history-list');
      
      if (state.transacoes.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-8">Nenhuma transa√ß√£o encontrada</p>';
        document.getElementById('history-count').textContent = '0';
        return;
      }

      let filteredTransacoes = state.transacoes;
      
      if (state.filterDate) {
        filteredTransacoes = filteredTransacoes.filter(t => t.data === state.filterDate);
      }

      const sorted = filteredTransacoes.sort((a, b) => {
        const dateA = new Date(a.criado_em || a.data);
        const dateB = new Date(b.criado_em || b.data);
        return dateB - dateA;
      });

      document.getElementById('history-count').textContent = sorted.length;

      list.innerHTML = sorted.map(t => {
        const isEntrada = t.tipo === 'entrada';
        const icon = isEntrada ? 'üí∞' : 'üí∏';
        const colorClass = isEntrada ? 'text-green-400' : 'text-red-400';
        
        return `
          <div class="history-item card rounded-xl p-4">
            <div class="flex items-center justify-between">
              <div class="flex-1 grid grid-cols-1 md:grid-cols-5 gap-3 text-sm">
                <div>
                  <p class="text-gray-400 text-xs">Tipo</p>
                  <p class="font-bold">${icon} ${isEntrada ? 'ENTRADA' : 'SA√çDA'}</p>
                </div>
                <div>
                  <p class="text-gray-400 text-xs">Categoria</p>
                  <p class="font-bold">${t.categoria || 'N/A'}</p>
                </div>
                <div>
                  <p class="text-gray-400 text-xs">Data</p>
                  <p class="font-bold">${new Date(t.data).toLocaleDateString('pt-BR')}</p>
                </div>
                <div>
                  <p class="text-gray-400 text-xs">Descri√ß√£o</p>
                  <p class="font-bold text-xs">${t.descricao || 'N/A'}</p>
                </div>
                <div>
                  <p class="text-gray-400 text-xs">Valor</p>
                  <p class="font-bold ${colorClass}">R$ ${parseFloat(t.valor).toFixed(2)}</p>
                </div>
              </div>
              <button class="del-transaction-btn bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-bold text-sm ml-4" data-id="${t.id}">
                üóëÔ∏è Excluir
              </button>
            </div>
          </div>
        `;
      }).join('');

      list.querySelectorAll('.del-transaction-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const id = btn.dataset.id;
          
          showModal('Excluir esta transa√ß√£o?', async () => {
            btn.disabled = true;
            btn.innerHTML = '<div class="spinner mx-auto"></div>';
            
            const result = await deletarTransacao(id);
            
            if (result.ok) {
              toast('Transa√ß√£o exclu√≠da!');
              await carregarDados();
            } else {
              toast('Erro ao excluir transa√ß√£o!', 'error');
              btn.disabled = false;
              btn.textContent = 'üóëÔ∏è Excluir';
            }
          });
        });
      });
    }

    document.getElementById('filter-date').addEventListener('change', (e) => {
      state.filterDate = e.target.value || null;
      renderHistory();
    });

    document.getElementById('clear-filters-btn').addEventListener('click', () => {
      document.getElementById('filter-date').value = '';
      state.filterDate = null;
      renderHistory();
      toast('Filtro limpo!');
    });

    // ====================================
    // RELAT√ìRIOS
    // ====================================
    function renderReports() {
      const container = document.getElementById('reports-container');
      const month = document.getElementById('report-month').value;
      const year = document.getElementById('report-year').value;

      if (!year) {
        container.innerHTML = '<p class="text-gray-400 text-center py-8">Selecione um ano</p>';
        return;
      }

      const monthTransacoes = state.transacoes.filter(t => {
        const tDate = new Date(t.data);
        return String(tDate.getMonth() + 1).padStart(2, '0') === month && 
               String(tDate.getFullYear()) === year;
      });

      const entradas = monthTransacoes.filter(t => t.tipo === 'entrada');
      const saidas = monthTransacoes.filter(t => t.tipo === 'saida');

      const totalEntradas = entradas.reduce((sum, t) => sum + parseFloat(t.valor), 0);
      const totalSaidas = saidas.reduce((sum, t) => sum + parseFloat(t.valor), 0);
      const saldo = totalEntradas - totalSaidas;

      // Agrupar por categoria
      const categorias = {};
      entradas.forEach(t => {
        const cat = t.categoria || 'Sem categoria';
        if (!categorias[cat]) {
          categorias[cat] = { quantidade: 0, valor: 0 };
        }
        categorias[cat].quantidade++;
        categorias[cat].valor += parseFloat(t.valor);
      });

      // Agrupar profissionais (pela descri√ß√£o)
      const profissionais = {};
      entradas.forEach(t => {
        const match = (t.descricao || '').match(/Profissional:\s*([^\-]+)/);
        const prof = match ? match[1].trim() : 'N√£o especificado';
        
        if (!profissionais[prof]) {
          profissionais[prof] = { quantidade: 0, valor: 0 };
        }
        profissionais[prof].quantidade++;
        profissionais[prof].valor += parseFloat(t.valor);
      });

      container.innerHTML = `
        <div class="card rounded-2xl p-6 mb-6">
          <h3 class="text-2xl font-bold text-green-400 mb-6">üìä Resumo do M√™s</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-zinc-900 rounded-xl p-6">
              <p class="text-sm text-gray-400 mb-2">üí∞ Entradas</p>
              <p class="text-3xl font-black text-green-400">R$ ${totalEntradas.toFixed(2)}</p>
              <p class="text-xs text-gray-500 mt-2">${entradas.length} transa√ß√µes</p>
            </div>
            <div class="bg-zinc-900 rounded-xl p-6">
              <p class="text-sm text-gray-400 mb-2">üí∏ Sa√≠das</p>
              <p class="text-3xl font-black text-red-400">R$ ${totalSaidas.toFixed(2)}</p>
              <p class="text-xs text-gray-500 mt-2">${saidas.length} transa√ß√µes</p>
            </div>
            <div class="bg-zinc-900 rounded-xl p-6">
              <p class="text-sm text-gray-400 mb-2">üíé Saldo</p>
              <p class="text-3xl font-black ${saldo >= 0 ? 'text-blue-400' : 'text-orange-400'}">R$ ${saldo.toFixed(2)}</p>
              <p class="text-xs text-gray-500 mt-2">${saldo >= 0 ? 'Positivo' : 'Negativo'}</p>
            </div>
            <div class="bg-zinc-900 rounded-xl p-6">
              <p class="text-sm text-gray-400 mb-2">üìä Ticket M√©dio</p>
              <p class="text-3xl font-black text-purple-400">R$ ${entradas.length > 0 ? (totalEntradas / entradas.length).toFixed(2) : '0.00'}</p>
              <p class="text-xs text-gray-500 mt-2">por entrada</p>
            </div>
          </div>
        </div>

        <div class="card rounded-2xl p-6 mb-6">
          <h3 class="text-2xl font-bold text-green-400 mb-6">üë• Por Profissional</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${Object.entries(profissionais)
              .sort((a, b) => b[1].valor - a[1].valor)
              .map(([nome, data]) => `
                <div class="bg-zinc-900 rounded-xl p-4">
                  <p class="font-bold text-lg mb-2">${nome}</p>
                  <div class="grid grid-cols-2 gap-3 text-sm">
                    <div>
                      <p class="text-gray-400">Atendimentos</p>
                      <p class="font-bold text-white">${data.quantidade}</p>
                    </div>
                    <div>
                      <p class="text-gray-400">Faturamento</p>
                      <p class="font-bold text-green-400">R$ ${data.valor.toFixed(2)}</p>
                    </div>
                  </div>
                </div>
              `).join('')}
          </div>
        </div>

        <div class="card rounded-2xl p-6">
          <h3 class="text-2xl font-bold text-green-400 mb-6">‚úÇÔ∏è Por Servi√ßo/Categoria</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            ${Object.entries(categorias)
              .sort((a, b) => b[1].valor - a[1].valor)
              .map(([nome, data]) => `
                <div class="bg-zinc-900 rounded-xl p-4">
                  <p class="font-bold text-lg mb-2">${nome}</p>
                  <div class="grid grid-cols-2 gap-3 text-sm">
                    <div>
                      <p class="text-gray-400">Quantidade</p>
                      <p class="font-bold text-white">${data.quantidade}x</p>
                    </div>
                    <div>
                      <p class="text-gray-400">Faturamento</p>
                      <p class="font-bold text-green-400">R$ ${data.valor.toFixed(2)}</p>
                    </div>
                  </div>
                </div>
              `).join('')}
          </div>
        </div>
      `;
    }

    document.getElementById('report-month').addEventListener('change', renderReports);
    document.getElementById('report-year').addEventListener('change', renderReports);

    // ====================================
    // EXTRATO
    // ====================================
    function renderExtrato() {
      const container = document.getElementById('extrato-container');
      const year = document.getElementById('extrato-year').value;
      const month = document.getElementById('extrato-month').value;

      if (!year) {
        container.innerHTML = '<p class="text-gray-400 text-center py-8">Selecione um ano</p>';
        return;
      }

      let filteredTransacoes = state.transacoes.filter(t => {
        const tDate = new Date(t.data);
        return String(tDate.getFullYear()) === year;
      });

      if (month) {
        filteredTransacoes = filteredTransacoes.filter(t => {
          const tDate = new Date(t.data);
          return String(tDate.getMonth() + 1).padStart(2, '0') === month;
        });
      }

      const entradas = filteredTransacoes.filter(t => t.tipo === 'entrada');
      const saidas = filteredTransacoes.filter(t => t.tipo === 'saida');

      const totalEntradas = entradas.reduce((sum, t) => sum + parseFloat(t.valor), 0);
      const totalSaidas = saidas.reduce((sum, t) => sum + parseFloat(t.valor), 0);
      const saldo = totalEntradas - totalSaidas;

      const periodo = month ? `${month}/${year}` : year;

      container.innerHTML = `
        <div class="card rounded-2xl p-6">
          <h3 class="text-2xl font-bold text-green-400 mb-6">üìÖ Extrato ${periodo}</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="bg-zinc-900 rounded-xl p-6">
              <p class="text-sm text-gray-400 mb-2">üí∞ Total Entradas</p>
              <p class="text-3xl font-black text-green-400">R$ ${totalEntradas.toFixed(2)}</p>
              <p class="text-sm text-gray-400 mt-4">${entradas.length} transa√ß√µes</p>
            </div>
            <div class="bg-zinc-900 rounded-xl p-6">
              <p class="text-sm text-gray-400 mb-2">üí∏ Total Sa√≠das</p>
              <p class="text-3xl font-black text-red-400">R$ ${totalSaidas.toFixed(2)}</p>
              <p class="text-sm text-gray-400 mt-4">${saidas.length} transa√ß√µes</p>
            </div>
            <div class="bg-zinc-900 rounded-xl p-6">
              <p class="text-sm text-gray-400 mb-2">üíé Saldo Final</p>
              <p class="text-3xl font-black ${saldo >= 0 ? 'text-blue-400' : 'text-orange-400'}">R$ ${saldo.toFixed(2)}</p>
              <p class="text-sm text-gray-400 mt-4">${saldo >= 0 ? 'Lucro' : 'Preju√≠zo'}</p>
            </div>
          </div>
        </div>
      `;
    }

    document.getElementById('extrato-year').addEventListener('change', renderExtrato);
    document.getElementById('extrato-month').addEventListener('change', renderExtrato);

    // ====================================
    // PROFISSIONAIS (LocalStorage)
    // ====================================
    document.getElementById('prof-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const name = document.getElementById('prof-name').value;
      const commission = parseFloat(document.getElementById('prof-commission').value);

      state.professionals.push({
        id: Date.now().toString(),
        name: name,
        commission: commission
      });

      salvarLocalStorage();
      toast('Colaborador adicionado!');
      e.target.reset();
      render();
    });

    function renderProfList() {
      const list = document.getElementById('prof-list');
      if (state.professionals.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-4">Nenhum colaborador cadastrado</p>';
        return;
      }

      list.innerHTML = state.professionals.map(p => `
        <div class="bg-zinc-900 rounded-xl p-4 flex items-center justify-between">
          <div>
            <p class="font-bold text-lg">${p.name}</p>
            <p class="text-sm text-gray-400">Comiss√£o: ${p.commission}%</p>
          </div>
          <button class="del-prof-btn bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-bold" data-id="${p.id}">Excluir</button>
        </div>
      `).join('');

      list.querySelectorAll('.del-prof-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          const prof = state.professionals.find(p => p.id === id);
          
          showModal(`Excluir ${prof.name}?`, () => {
            state.professionals = state.professionals.filter(p => p.id !== id);
            salvarLocalStorage();
            toast('Profissional exclu√≠do!');
            render();
          });
        });
      });
    }

    // ====================================
    // SERVI√áOS (LocalStorage)
    // ====================================
    document.getElementById('service-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const name = document.getElementById('service-name').value;
      const value = parseFloat(document.getElementById('service-value').value);

      state.services.push({
        id: Date.now().toString(),
        name: name,
        value: value
      });

      salvarLocalStorage();
      toast('‚úÖ Servi√ßo cadastrado!');
      e.target.reset();
      render();
    });

    function renderServiceList() {
      const list = document.getElementById('service-list');
      const count = document.getElementById('service-count');
      count.textContent = state.services.length;

      if (state.services.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-4">Nenhum servi√ßo cadastrado</p>';
        return;
      }

      list.innerHTML = state.services.map(s => `
        <div class="service-item bg-zinc-900 rounded-lg p-3 flex items-center justify-between">
          <div class="flex-1">
            <p class="font-bold">${s.name}</p>
            <p class="text-sm text-green-400">R$ ${s.value.toFixed(2)}</p>
          </div>
          <button class="del-service-btn bg-red-600 hover:bg-red-700 px-3 py-1 rounded-lg font-bold text-sm" data-id="${s.id}">Excluir</button>
        </div>
      `).join('');

      list.querySelectorAll('.del-service-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          const service = state.services.find(s => s.id === id);
          
          showModal(`Excluir ${service.name}?`, () => {
            state.services = state.services.filter(s => s.id !== id);
            salvarLocalStorage();
            toast('Servi√ßo exclu√≠do!');
            render();
          });
        });
      });
    }

    // Importar Servi√ßos
    document.getElementById('import-btn').addEventListener('click', () => {
      const servicos = [
        { name: 'CORTE', value: 40.00 },
        { name: 'CABELO M√âDIO', value: 50.00 },
        { name: 'CORTE CARECA', value: 30.00 },
        { name: 'CORTE+SOBRANCELHA+BOTOX', value: 140.00 },
        { name: 'CORTE+SOBRANCELHA', value: 50.00 },
        { name: 'CORTE+BARBA', value: 80.00 },
        { name: 'BARBA', value: 40.00 }
      ];

      servicos.forEach(s => {
        const exists = state.services.find(existing => existing.name.toLowerCase() === s.name.toLowerCase());
        if (!exists) {
          state.services.push({
            id: Date.now().toString() + Math.random(),
            name: s.name,
            value: s.value
          });
        }
      });

      salvarLocalStorage();
      toast('‚úÖ Servi√ßos importados!');
      render();
    });

    // ====================================
    // CUSTOS
    // ====================================
    document.getElementById('cost-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const btn = e.target.querySelector('button');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner mx-auto"></div>';

      const date = document.getElementById('cost-date').value;
      const desc = document.getElementById('cost-desc').value;
      const value = parseFloat(document.getElementById('cost-value').value);

      const transacao = {
        data: date,
        tipo: 'saida',
        valor: value,
        categoria: 'Custo Operacional',
        descricao: desc
      };
      
      const result = await adicionarTransacao(transacao);
      
      if (result.ok) {
        toast('Custo registrado!');
        e.target.reset();
        document.getElementById('cost-date').value = new Date().toISOString().split('T')[0];
        await carregarDados();
      } else {
        toast('Erro ao registrar custo!', 'error');
      }
      
      btn.disabled = false;
      btn.textContent = 'REGISTRAR CUSTO';
    });

    function renderCostList() {
      const list = document.getElementById('cost-list');
      const costs = state.transacoes.filter(t => t.tipo === 'saida');
      
      if (costs.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-4">Nenhum custo registrado</p>';
        return;
      }

      const recent = costs.slice(-10).reverse();

      list.innerHTML = recent.map(c => `
        <div class="cost-item bg-zinc-900 rounded-lg p-3 flex items-center justify-between mb-2">
          <div>
            <p class="font-bold">${c.descricao || 'N/A'}</p>
            <p class="text-sm text-gray-400">${c.categoria || 'Custo'} ‚Ä¢ ${new Date(c.data).toLocaleDateString('pt-BR')}</p>
            <p class="text-sm text-red-400 font-bold mt-1">R$ ${parseFloat(c.valor).toFixed(2)}</p>
          </div>
          <button class="del-cost-btn bg-red-600 hover:bg-red-700 px-3 py-1 rounded-lg font-bold text-sm" data-id="${c.id}">Excluir</button>
        </div>
      `).join('');

      list.querySelectorAll('.del-cost-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          
          showModal('Excluir este custo?', async () => {
            const result = await deletarTransacao(id);
            
            if (result.ok) {
              toast('Custo exclu√≠do!');
              await carregarDados();
            } else {
              toast('Erro ao excluir custo!', 'error');
            }
          });
        });
      });
    }

    // ====================================
    // SELECTS
    // ====================================
    function updateSelects() {
      const quickProf = document.getElementById('quick-prof');
      const profs = [{name: 'THIAGO'}, ...state.professionals];
      
      const quickValue = quickProf.value;
      quickProf.innerHTML = '<option value="">Selecione o profissional</option>' + 
        profs.map(p => `<option value="${p.name}">${p.name === 'THIAGO' ? 'üëë ' : ''}${p.name}</option>`).join('');
      if (quickValue) quickProf.value = quickValue;
    }

    // ====================================
    // TABS
    // ====================================
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => {
          b.classList.remove('active', 'text-green-400', 'border-b-2', 'border-green-400');
          b.classList.add('text-gray-400');
        });
        btn.classList.add('active', 'text-green-400', 'border-b-2', 'border-green-400');
        btn.classList.remove('text-gray-400');

        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.getElementById(`tab-${btn.dataset.tab}`).classList.remove('hidden');

        if (btn.dataset.tab === 'historico') renderHistory();
        if (btn.dataset.tab === 'relatorios') renderReports();
        if (btn.dataset.tab === 'extrato') renderExtrato();
        if (btn.dataset.tab === 'custos') renderCostList();
      });
    });

    // ====================================
    // EDITOR DE C√ìDIGO
    // ====================================
    document.getElementById('floating-editor-btn').addEventListener('click', () => {
      document.getElementById('editor-modal').classList.remove('hidden');
      if (!editorInstance) {
        initEditor();
      }
    });

    document.getElementById('close-editor-btn').addEventListener('click', () => {
      document.getElementById('editor-modal').classList.add('hidden');
    });

    function initEditor() {
      if (editorInstance) return;

      editorInstance = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
        mode: 'javascript',
        theme: 'dracula',
        lineNumbers: true,
        autoCloseBrackets: true,
        matchBrackets: true,
        styleActiveLine: true,
        indentUnit: 2,
        tabSize: 2,
        lineWrapping: true
      });

      editorInstance.setSize('100%', '600px');

      editorInstance.on('change', () => {
        const content = editorInstance.getValue();
        const lines = content.split('\n').length;
        const chars = content.length;
        document.getElementById('editor-lines').textContent = lines;
        document.getElementById('editor-chars').textContent = chars;
      });

      document.getElementById('editor-language').addEventListener('change', (e) => {
        editorInstance.setOption('mode', e.target.value);
      });

      document.getElementById('editor-theme').addEventListener('change', (e) => {
        editorInstance.setOption('theme', e.target.value);
      });

      document.getElementById('editor-fontsize').addEventListener('change', (e) => {
        document.querySelector('.CodeMirror').style.fontSize = e.target.value + 'px';
        editorInstance.refresh();
      });

      let lineNumbersEnabled = true;
      document.getElementById('toggle-linenumbers-btn').addEventListener('click', () => {
        lineNumbersEnabled = !lineNumbersEnabled;
        editorInstance.setOption('lineNumbers', lineNumbersEnabled);
        document.getElementById('toggle-linenumbers-btn').textContent = 
          lineNumbersEnabled ? 'üìÑ Linhas: ON' : 'üìÑ Linhas: OFF';
      });

      document.getElementById('clear-editor-btn').addEventListener('click', () => {
        if (editorInstance.getValue().trim() !== '') {
          showModal('Limpar todo o conte√∫do do editor?', () => {
            editorInstance.setValue('');
            addConsoleMessage('Editor limpo!', 'info');
          });
        }
      });

      document.getElementById('format-code-btn').addEventListener('click', () => {
        try {
          const code = editorInstance.getValue();
          const mode = editorInstance.getOption('mode');
          
          if (mode === 'application/json') {
            const formatted = JSON.stringify(JSON.parse(code), null, 2);
            editorInstance.setValue(formatted);
            addConsoleMessage('‚úÖ JSON formatado com sucesso!', 'success');
          } else {
            addConsoleMessage('‚ö†Ô∏è Formata√ß√£o autom√°tica dispon√≠vel apenas para JSON', 'warning');
          }
        } catch (e) {
          addConsoleMessage('‚ùå Erro ao formatar: ' + e.message, 'error');
        }
      });

      document.getElementById('export-code-btn').addEventListener('click', () => {
        const code = editorInstance.getValue();
        const blob = new Blob([code], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'code-export.txt';
        a.click();
        URL.revokeObjectURL(url);
        addConsoleMessage('üì• C√≥digo exportado com sucesso!', 'success');
      });

      document.getElementById('run-code-btn').addEventListener('click', () => {
        const code = editorInstance.getValue();
        const mode = editorInstance.getOption('mode');
        
        clearConsole();
        
        if (mode === 'javascript') {
          executeJavaScript(code);
        } else {
          addConsoleMessage(`‚ö†Ô∏è Execu√ß√£o dispon√≠vel apenas para JavaScript. Modo atual: ${mode}`, 'warning');
        }
      });

      document.getElementById('clear-console-btn').addEventListener('click', clearConsole);

      document.getElementById('load-page-code-btn').addEventListener('click', () => {
        const pageHTML = document.documentElement.outerHTML;
        editorInstance.setValue(pageHTML);
        editorInstance.setOption('mode', 'htmlmixed');
        document.getElementById('editor-language').value = 'htmlmixed';
        addConsoleMessage('üìÑ C√≥digo completo da p√°gina carregado no editor!', 'success');
        addConsoleMessage(`Total de ${pageHTML.length} caracteres carregados`, 'info');
      });

      document.getElementById('save-snippet-btn').addEventListener('click', () => {
        const code = editorInstance.getValue();
        if (!code.trim()) {
          toast('Escreva algum c√≥digo antes de salvar!', 'error');
          return;
        }
        document.getElementById('snippet-modal').classList.remove('hidden');
      });

      document.getElementById('snippet-modal-cancel').addEventListener('click', () => {
        document.getElementById('snippet-modal').classList.add('hidden');
        document.getElementById('snippet-name').value = '';
      });

      document.getElementById('snippet-modal-save').addEventListener('click', () => {
        const name = document.getElementById('snippet-name').value.trim();
        if (!name) {
          toast('Digite um nome para o snippet!', 'error');
          return;
        }

        const code = editorInstance.getValue();
        const language = editorInstance.getOption('mode');

        state.snippets.push({
          id: Date.now().toString(),
          name: name,
          code: code,
          language: language,
          created: new Date().toISOString()
        });

        salvarLocalStorage();
        toast('üíæ Snippet salvo com sucesso!');
        document.getElementById('snippet-modal').classList.add('hidden');
        document.getElementById('snippet-name').value = '';
        renderSnippets();
      });

      renderSnippets();
    }

    function addConsoleMessage(msg, type = 'log') {
      const console = document.getElementById('console-output');
      const colors = {
        log: 'text-gray-300',
        info: 'text-blue-400',
        success: 'text-green-400',
        warning: 'text-yellow-400',
        error: 'text-red-400'
      };

      const div = document.createElement('div');
      div.className = `${colors[type]} mb-2`;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      console.appendChild(div);
      console.scrollTop = console.scrollHeight;
    }

    function clearConsole() {
      document.getElementById('console-output').innerHTML = '';
      addConsoleMessage('Console limpo!', 'info');
    }

    function executeJavaScript(code) {
      const originalConsoleLog = console.log;
      const originalConsoleError = console.error;
      const originalConsoleWarn = console.warn;

      console.log = (...args) => {
        addConsoleMessage(args.join(' '), 'log');
        originalConsoleLog.apply(console, args);
      };

      console.error = (...args) => {
        addConsoleMessage('ERROR: ' + args.join(' '), 'error');
        originalConsoleError.apply(console, args);
      };

      console.warn = (...args) => {
        addConsoleMessage('WARN: ' + args.join(' '), 'warning');
        originalConsoleWarn.apply(console, args);
      };

      try {
        addConsoleMessage('‚ñ∂Ô∏è Executando c√≥digo...', 'info');
        const result = eval(code);
        if (result !== undefined) {
          addConsoleMessage('Resultado: ' + JSON.stringify(result), 'success');
        }
        addConsoleMessage('‚úÖ Execu√ß√£o conclu√≠da!', 'success');
      } catch (e) {
        addConsoleMessage('‚ùå Erro: ' + e.message, 'error');
      } finally {
        console.log = originalConsoleLog;
        console.error = originalConsoleError;
        console.warn = originalConsoleWarn;
      }
    }

    function renderSnippets() {
      const list = document.getElementById('snippets-list');
      
      if (state.snippets.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-4">Nenhum snippet salvo</p>';
        return;
      }

      const sorted = state.snippets.sort((a, b) => new Date(b.created) - new Date(a.created));

      list.innerHTML = sorted.map(s => `
        <div class="bg-zinc-900 rounded-lg p-4 flex items-center justify-between">
          <div class="flex-1">
            <p class="font-bold text-lg">${s.name}</p>
            <p class="text-sm text-gray-400">${s.language} ‚Ä¢ ${new Date(s.created).toLocaleString('pt-BR')}</p>
          </div>
          <div class="flex gap-2">
            <button class="load-snippet-btn bg-blue-600 hover:bg-blue-700 px-3 py-2 rounded-lg font-bold text-sm" data-id="${s.id}">üìÇ Carregar</button>
            <button class="del-snippet-btn bg-red-600 hover:bg-red-700 px-3 py-2 rounded-lg font-bold text-sm" data-id="${s.id}">Excluir</button>
          </div>
        </div>
      `).join('');

      list.querySelectorAll('.load-snippet-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          const snippet = state.snippets.find(s => s.id === id);
          if (editorInstance && snippet) {
            editorInstance.setValue(snippet.code);
            editorInstance.setOption('mode', snippet.language);
            document.getElementById('editor-language').value = snippet.language;
            toast(`üìÇ Snippet "${snippet.name}" carregado!`);
            window.scrollTo({ top: 0, behavior: 'smooth' });
          }
        });
      });

      list.querySelectorAll('.del-snippet-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.dataset.id;
          const snippet = state.snippets.find(s => s.id === id);
          
          showModal(`Excluir snippet "${snippet.name}"?`, () => {
            state.snippets = state.snippets.filter(s => s.id !== id);
            salvarLocalStorage();
            toast('Snippet exclu√≠do!');
            renderSnippets();
          });
        });
      });
    }

    // ====================================
    // DATA/HORA NO HEADER
    // ====================================
    function updateHeaderDateTime() {
      const now = new Date();
      const dateStr = now.toLocaleDateString('pt-BR', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      const timeStr = now.toLocaleTimeString('pt-BR', { 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit'
      });
      
      document.getElementById('header-date').textContent = dateStr.toUpperCase();
      document.getElementById('header-time').textContent = timeStr;
    }

    // ====================================
    // INICIALIZA√á√ÉO
    // ====================================
    async function initApp() {
      console.log('üöÄ Iniciando aplica√ß√£o...');
      
      const today = new Date().toISOString().split('T')[0];
      const now = new Date().toTimeString().slice(0, 5);
      
      document.getElementById('quick-date').value = today;
      document.getElementById('quick-time').value = now;
      document.getElementById('report-month').value = String(new Date().getMonth() + 1).padStart(2, '0');
      document.getElementById('report-year').value = new Date().getFullYear();
      document.getElementById('extrato-year').value = new Date().getFullYear();
      document.getElementById('cost-date').value = today;
      
      document.getElementById('filter-date').value = today;
      state.filterDate = today;

      updateHeaderDateTime();
      setInterval(updateHeaderDateTime, 1000);

      await carregarDados();
      
      console.log('‚úÖ Sistema iniciado com sucesso!');
    }

    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bd68f03937e5f28',t:'MTc2ODMyNDc2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
