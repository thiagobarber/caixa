<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema Barbearia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&amp;family=Inter:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      font-family: 'Inter', sans-serif;
    }
    
    .title-font {
      font-family: 'Bebas Neue', sans-serif;
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 12px;
      color: white;
      font-weight: 700;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
    }
    
    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      animation: spin 0.6s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .card {
      background: linear-gradient(135deg, #18181b 0%, #0a0a0a 100%);
      border: 1px solid rgba(82, 82, 91, 0.2);
      transition: all 0.3s ease;
    }

    .card:hover {
      border-color: rgba(82, 82, 91, 0.4);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-black text-gray-100">
  <div id="app" class="h-full w-full overflow-auto"><!-- Header -->
   <header class="bg-gradient-to-r from-zinc-950 to-black border-b border-zinc-800 px-6 py-5">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
     <div>
      <h1 class="title-font text-4xl text-green-400 tracking-wider">CAIXA BARBEIRO</h1>
      <p class="text-sm text-gray-400 mt-1">CNPJ: 32.554.785/0001-30</p>
     </div>
     <div class="text-right">
      <p id="header-date" class="text-lg font-bold text-green-400"></p>
      <p id="header-time" class="text-2xl font-black text-white title-font tracking-wider"></p>
     </div>
    </div>
   </header><!-- Tabs -->
   <nav class="bg-zinc-950 border-b border-zinc-800">
    <div class="max-w-7xl mx-auto px-4">
     <div class="flex gap-1"><button class="tab-btn active px-3 py-3 font-bold text-xs flex-1 whitespace-nowrap" data-tab="registro">‚úçÔ∏è REGISTRO</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="historico">üìä HIST√ìRICO</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="relatorios">üìà RELAT√ìRIOS</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="extrato">üíº EXTRATO</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="profissionais">üë• PROFIS</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="servicos">üíà SERVI√áOS</button> <button class="tab-btn px-3 py-3 font-bold text-xs flex-1 text-gray-400 whitespace-nowrap" data-tab="custos">üí≥ CUSTOS</button>
     </div>
    </div>
   </nav><!-- Main Content -->
   <main class="max-w-7xl mx-auto px-4 py-8"><!-- TAB: REGISTRO -->
    <div id="tab-registro" class="tab-content">
     <div class="card rounded-2xl p-6 mb-6">
      <h2 class="text-2xl font-bold text-green-400 mb-6">‚ö° Registro R√°pido</h2><!-- Selecionar Profissional, Data e Hor√°rio -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
       <div><label class="block text-sm font-bold mb-3 text-gray-300">PROFISSIONAL:</label> <select id="quick-prof" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-lg font-semibold focus:border-green-500 focus:outline-none"> <option value="">Selecione o profissional</option> <option value="THIAGO">üëë THIAGO (Propriet√°rio)</option> </select>
       </div>
       <div><label class="block text-sm font-bold mb-3 text-gray-300">DATA DO ATENDIMENTO:</label> <input type="date" id="quick-date" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-lg font-semibold focus:border-green-500 focus:outline-none">
       </div>
       <div><label class="block text-sm font-bold mb-3 text-gray-300">HOR√ÅRIO:</label> <input type="time" id="quick-time" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-lg font-semibold focus:border-green-500 focus:outline-none">
       </div>
      </div><!-- Seletor de Servi√ßos -->
      <div class="mb-6"><label class="block text-sm font-bold mb-3 text-gray-300">ADICIONAR SERVI√áO:</label>
       <div class="flex gap-3"><select id="service-selector" class="flex-1 bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3 text-lg font-semibold focus:border-green-500 focus:outline-none"> <option value="">Selecione um servi√ßo</option> </select> <button id="add-service-btn" class="btn-primary text-white font-black px-8 py-3 rounded-xl whitespace-nowrap"> ‚ûï ADICIONAR </button>
       </div>
      </div><!-- Servi√ßos Selecionados -->
      <div id="selected-services-container" class="mb-6 hidden"><label class="block text-sm font-bold mb-3 text-gray-300">SELECIONADOS:</label>
       <div id="selected-services" class="bg-zinc-900 rounded-xl p-4 space-y-2"></div>
       <div class="mt-4 flex items-center justify-between bg-zinc-900 rounded-xl p-4"><span class="text-lg font-bold text-gray-300">TOTAL:</span> <span id="total-value" class="text-2xl font-black text-green-400">R$ 0,00</span>
       </div>
      </div><!-- Bot√µes de A√ß√£o -->
      <div class="flex gap-3"><button id="save-quick-btn" class="flex-1 btn-primary text-white font-black py-4 rounded-xl text-lg shadow-lg"> üíæ SALVAR ATENDIMENTO </button> <button id="clear-quick-btn" class="bg-zinc-800 hover:bg-zinc-700 text-white font-bold px-6 py-4 rounded-xl"> üóëÔ∏è LIMPAR </button>
      </div>
     </div>
    </div><!-- TAB: HIST√ìRICO -->
    <div id="tab-historico" class="tab-content hidden">
     <div class="card rounded-2xl p-6">
      <div class="flex items-center justify-between mb-6">
       <h2 class="text-2xl font-bold text-green-400">üìã Hist√≥rico de Atendimentos</h2>
       <div class="flex gap-2"><button id="select-all-btn" class="bg-zinc-800 hover:bg-zinc-700 text-white font-bold px-4 py-2 rounded-xl text-sm hidden"> ‚úÖ Selecionar Todos </button> <button id="delete-selected-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold px-4 py-2 rounded-xl text-sm hidden"> üóëÔ∏è Excluir Selecionados (<span id="selected-count">0</span>) </button>
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
       <div><label for="filter-date" class="block text-sm font-bold mb-2">Data Espec√≠fica:</label> <input type="date" id="filter-date" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2">
       </div>
       <div><label for="filter-month" class="block text-sm font-bold mb-2">M√™s:</label> <select id="filter-month" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2"> <option value="">Todos</option> <option value="01">Janeiro</option> <option value="02">Fevereiro</option> <option value="03">Mar√ßo</option> <option value="04">Abril</option> <option value="05">Maio</option> <option value="06">Junho</option> <option value="07">Julho</option> <option value="08">Agosto</option> <option value="09">Setembro</option> <option value="10">Outubro</option> <option value="11">Novembro</option> <option value="12">Dezembro</option> </select>
       </div>
       <div><label for="filter-prof" class="block text-sm font-bold mb-2">Profissional:</label> <select id="filter-prof" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2"> <option value="">Todos</option> </select>
       </div>
       <div><label for="filter-status" class="block text-sm font-bold mb-2">Status:</label> <select id="filter-status" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2"> <option value="">Todos</option> <option value="Pago">Pago</option> <option value="Pendente">Pendente</option> </select>
       </div>
      </div>
      <div id="history-list" class="space-y-3"></div>
     </div>
    </div><!-- TAB: RELAT√ìRIOS -->
    <div id="tab-relatorios" class="tab-content hidden">
     <div class="card rounded-2xl p-6 mb-6">
      <div class="flex items-center justify-between mb-6">
       <h2 class="text-2xl font-bold text-green-400">üìä Filtros</h2><button id="toggle-owner-btn" class="bg-zinc-800 hover:bg-zinc-700 text-white font-bold px-6 py-3 rounded-xl flex items-center gap-2"> <span id="toggle-icon">üëÅÔ∏è</span> <span id="toggle-text">Ocultar Propriet√°rio</span> </button>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
       <div><label for="report-date" class="block text-sm font-bold mb-2">Data:</label> <input type="date" id="report-date" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2">
       </div>
       <div><label for="report-month" class="block text-sm font-bold mb-2">M√™s:</label> <select id="report-month" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2"> <option value="01">Janeiro</option> <option value="02">Fevereiro</option> <option value="03">Mar√ßo</option> <option value="04">Abril</option> <option value="05">Maio</option> <option value="06">Junho</option> <option value="07">Julho</option> <option value="08">Agosto</option> <option value="09">Setembro</option> <option value="10">Outubro</option> <option value="11">Novembro</option> <option value="12">Dezembro</option> </select>
       </div>
       <div><label for="report-year" class="block text-sm font-bold mb-2">Ano:</label> <input type="number" id="report-year" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2">
       </div>
      </div>
     </div>
     <div id="reports-container" class="space-y-6"></div>
    </div><!-- TAB: EXTRATO -->
    <div id="tab-extrato" class="tab-content hidden">
     <div class="card rounded-2xl p-6 mb-6">
      <h2 class="text-2xl font-bold text-green-400 mb-6">üìÖ Filtro de Per√≠odo</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label for="extrato-year" class="block text-sm font-bold mb-2">Ano:</label> <input type="number" id="extrato-year" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2">
       </div>
       <div><label for="extrato-month" class="block text-sm font-bold mb-2">M√™s (opcional):</label> <select id="extrato-month" class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-2"> <option value="">Anual (todos os meses)</option> <option value="01">Janeiro</option> <option value="02">Fevereiro</option> <option value="03">Mar√ßo</option> <option value="04">Abril</option> <option value="05">Maio</option> <option value="06">Junho</option> <option value="07">Julho</option> <option value="08">Agosto</option> <option value="09">Setembro</option> <option value="10">Outubro</option> <option value="11">Novembro</option> <option value="12">Dezembro</option> </select>
       </div>
      </div>
     </div>
     <div id="extrato-container" class="space-y-6"></div>
    </div><!-- TAB: PROFISSIONAIS -->
    <div id="tab-profissionais" class="tab-content hidden">
     <div class="card rounded-2xl p-6 mb-6">
      <h2 class="text-2xl font-bold text-green-400 mb-4">üëë Propriet√°rio</h2>
      <div class="bg-zinc-900 rounded-xl p-6">
       <p class="text-3xl font-black text-green-400">THIAGO</p>
       <p class="text-gray-400 mt-2">Recebe 50% de comiss√£o dos colaboradores</p>
      </div>
     </div>
     <div class="card rounded-2xl p-6">
      <h2 class="text-2xl font-bold text-green-400 mb-4">üë• Colaboradores</h2>
      <form id="prof-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"><input type="text" id="prof-name" required placeholder="Nome do colaborador" class="bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 font-semibold"> <input type="number" id="prof-commission" required placeholder="Comiss√£o %" min="0" max="100" class="bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 font-semibold"> <button type="submit" class="btn-primary text-white font-black py-3 rounded-xl">ADICIONAR</button>
      </form>
      <div id="prof-list" class="space-y-3"></div>
     </div>
    </div><!-- TAB: SERVI√áOS -->
    <div id="tab-servicos" class="tab-content hidden">
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="card rounded-2xl p-6">
       <h2 class="text-2xl font-bold text-green-400 mb-4">‚úÇÔ∏è Cadastrar Servi√ßo</h2>
       <form id="service-form" class="space-y-4"><input type="text" id="service-name" required placeholder="Nome do servi√ßo" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 font-semibold"> <input type="number" id="service-value" required placeholder="Valor R$" step="0.01" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 font-semibold"> <button type="submit" class="w-full btn-primary text-white font-black py-3 rounded-xl">CADASTRAR</button> <button type="button" id="cancel-edit-service" class="w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-xl hidden">CANCELAR EDI√á√ÉO</button>
       </form>
       <div class="mt-6 pt-6 border-t border-slate-700"><button id="import-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-3 rounded-xl"> üì• IMPORTAR SERVI√áOS PADR√ÉO </button>
       </div>
      </div>
      <div class="card rounded-2xl p-6">
       <h2 class="text-2xl font-bold text-green-400 mb-4">Lista (<span id="service-count">0</span>)</h2>
       <div id="service-list" class="space-y-2 max-h-96 overflow-y-auto"></div>
      </div>
     </div>
    </div><!-- TAB: CUSTOS -->
    <div id="tab-custos" class="tab-content hidden">
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="card rounded-2xl p-6">
       <h2 class="text-2xl font-bold text-green-400 mb-4">üí∞ Registrar Custo</h2>
       <form id="cost-form" class="space-y-4"><input type="date" id="cost-date" required class="w-full bg-zinc-900 border border-zinc-700 rounded-xl px-4 py-3"> <select id="cost-category" required class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 font-semibold"> <option value="">Categoria</option> <option value="Aluguel">Aluguel</option> <option value="Energia">Energia</option> <option value="√Ågua">√Ågua</option> <option value="Internet">Internet</option> <option value="Produtos">Produtos</option> <option value="Equipamentos">Equipamentos</option> <option value="Manuten√ß√£o">Manuten√ß√£o</option> <option value="Marketing">Marketing</option> <option value="Outros">Outros</option> </select> <input type="text" id="cost-desc" required placeholder="Descri√ß√£o" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3"> <input type="number" id="cost-value" required placeholder="Valor R$" step="0.01" class="w-full bg-slate-700 border border-slate-600 rounded-xl px-4 py-3 font-semibold"> <button type="submit" class="w-full btn-primary text-white font-black py-3 rounded-xl">REGISTRAR</button>
       </form>
      </div>
      <div class="card rounded-2xl p-6">
       <h2 class="text-2xl font-bold text-green-400 mb-4">Custos Recentes</h2>
       <div id="cost-list" class="space-y-2 max-h-96 overflow-y-auto"></div>
      </div>
     </div>
    </div>
   </main><!-- Modal de Confirma√ß√£o -->
   <div id="modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
    <div class="bg-slate-800 rounded-2xl p-6 max-w-md w-full mx-4 border border-slate-700">
     <h3 class="text-xl font-bold text-red-400 mb-4">‚ö†Ô∏è Confirmar Exclus√£o</h3>
     <p id="modal-text" class="text-gray-300 mb-6"></p>
     <div class="flex gap-3"><button id="modal-cancel" class="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-xl">CANCELAR</button> <button id="modal-confirm" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl">EXCLUIR</button>
     </div>
    </div>
   </div>
  </div>
  <script>
    // API Config
    const API_URL = 'https://script.google.com/macros/s/AKfycbwcwmkZYIpAyqwPej-Myb4JI8mc6QUovHQnTJBQM9mJej9eAfVVxncNT_aJPURoy06t/exec';
    const TOKEN = '753826';

    // Estado Global
    const state = {
      services: [],
      professionals: [],
      appointments: [],
      costs: [],
      selectedServices: [],
      deleteCallback: null,
      selectedForDeletion: new Set(),
      showOwnerValues: true,
      allData: []
    };

    // API Functions
    async function apiList() {
      try {
        const response = await fetch(`${API_URL}?acao=listar&token=${TOKEN}`);
        const data = await response.json();
        return data || [];
      } catch (error) {
        console.error('Erro ao listar:', error);
        return [];
      }
    }

    async function apiAdd(payload) {
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            acao: 'adicionar',
            token: TOKEN,
            ...payload
          })
        });
        return await response.json();
      } catch (error) {
        console.error('Erro ao adicionar:', error);
        return { success: false };
      }
    }

    async function apiDelete(id) {
      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            acao: 'deletar',
            token: TOKEN,
            id: id
          })
        });
        return await response.json();
      } catch (error) {
        console.error('Erro ao deletar:', error);
        return { success: false };
      }
    }

    // Load Data
    async function loadData() {
      const data = await apiList();
      state.allData = data;
      
      state.services = [];
      state.professionals = [];
      state.appointments = [];
      state.costs = [];

      data.forEach(record => {
        if (record.categoria === 'servico') {
          state.services.push({
            id: record.id,
            name: record.descricao,
            value: parseFloat(record.valor) || 0
          });
        } else if (record.categoria === 'profissional') {
          state.professionals.push({
            id: record.id,
            name: record.descricao,
            commission: parseFloat(record.valor) || 0
          });
        } else if (record.categoria === 'atendimento') {
          const dateObj = new Date(record.data);
          state.appointments.push({
            id: record.id,
            professionalName: record.tipo || '',
            serviceName: record.descricao || '',
            value: parseFloat(record.valor) || 0,
            status: 'Pago',
            date: record.data,
            time: dateObj.toTimeString().slice(0, 5),
            month: String(dateObj.getMonth() + 1).padStart(2, '0'),
            year: String(dateObj.getFullYear())
          });
        } else if (record.categoria && record.categoria.startsWith('custo_')) {
          state.costs.push({
            id: record.id,
            date: record.data,
            category: record.tipo || '',
            description: record.descricao || '',
            value: parseFloat(record.valor) || 0,
            costType: record.categoria === 'custo_fixo' ? 'Fixo' : 'Vari√°vel'
          });
        }
      });

      const activeTab = document.querySelector('.tab-btn.active')?.dataset.tab;
      if (!activeTab || activeTab === 'registro') {
        render();
      } else if (activeTab === 'historico') {
        renderHistory();
      } else if (activeTab === 'relatorios') {
        renderReports();
      } else if (activeTab === 'extrato') {
        renderExtrato();
      } else if (activeTab === 'profissionais') {
        renderProfList();
      } else if (activeTab === 'servicos') {
        renderServiceList();
      } else if (activeTab === 'custos') {
        renderCostList();
      }
    }

    // Toast
    function toast(msg, type = 'success') {
      const div = document.createElement('div');
      div.className = `toast ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
      div.textContent = msg;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 3000);
    }

    // Modal
    function showModal(msg, callback) {
      document.getElementById('modal-text').textContent = msg;
      document.getElementById('modal').classList.remove('hidden');
      state.deleteCallback = callback;
    }

    document.getElementById('modal-cancel').onclick = () => {
      document.getElementById('modal').classList.add('hidden');
      state.deleteCallback = null;
    };

    document.getElementById('modal-confirm').onclick = () => {
      if (state.deleteCallback) state.deleteCallback();
      document.getElementById('modal').classList.add('hidden');
      state.deleteCallback = null;
    };

    // Tabs
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.tab-btn').forEach(b => {
          b.classList.remove('active', 'text-green-400', 'border-b-2', 'border-green-400');
          b.classList.add('text-gray-400');
        });
        btn.classList.add('active', 'text-green-400', 'border-b-2', 'border-green-400');
        btn.classList.remove('text-gray-400');

        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.getElementById(`tab-${btn.dataset.tab}`).classList.remove('hidden');

        if (btn.dataset.tab === 'historico') renderHistory();
        if (btn.dataset.tab === 'relatorios') renderReports();
        if (btn.dataset.tab === 'extrato') renderExtrato();
      };
    });

    // Render Principal
    function render() {
      renderServiceSelector();
      renderProfList();
      renderServiceList();
      renderCostList();
      updateSelects();
    }

    // Render Seletor de Servi√ßos
    function renderServiceSelector() {
      const selector = document.getElementById('service-selector');
      if (!selector) return;
      
      const currentValue = selector.value;
      
      if (state.services.length === 0) {
        selector.innerHTML = '<option value="">Nenhum servi√ßo cadastrado</option>';
        return;
      }

      selector.innerHTML = '<option value="">Selecione um servi√ßo</option>' + 
        state.services
          .sort((a, b) => a.name.localeCompare(b.name))
          .map(s => `<option value="${s.id}">${s.name} - R$ ${s.value.toFixed(2)}</option>`)
          .join('');
      
      if (currentValue) selector.value = currentValue;
    }

    // Adicionar servi√ßo selecionado
    document.getElementById('add-service-btn').onclick = () => {
      const selector = document.getElementById('service-selector');
      const serviceId = selector.value;
      
      if (!serviceId) {
        toast('Selecione um servi√ßo!', 'error');
        return;
      }
      
      const service = state.services.find(s => s.id === serviceId);
      if (!service) return;
      
      const exists = state.selectedServices.find(s => s.id === serviceId);
      if (exists) {
        exists.qty++;
      } else {
        state.selectedServices.push({...service, qty: 1});
      }
      
      selector.value = '';
      renderSelectedServices();
    };

    // Render Servi√ßos Selecionados
    function renderSelectedServices() {
      const container = document.getElementById('selected-services-container');
      const list = document.getElementById('selected-services');
      const totalEl = document.getElementById('total-value');

      if (state.selectedServices.length === 0) {
        container.classList.add('hidden');
        return;
      }

      container.classList.remove('hidden');
      
      let total = 0;
      list.innerHTML = state.selectedServices.map(s => {
        const subtotal = s.value * s.qty;
        total += subtotal;
        return `
          <div class="flex items-center justify-between bg-slate-700 rounded-lg p-3">
            <div class="flex-1">
              <p class="font-bold">${s.name}</p>
              <p class="text-sm text-gray-400">R$ ${s.value.toFixed(2)} x ${s.qty}</p>
            </div>
            <div class="flex items-center gap-3">
              <button class="qty-btn bg-slate-600 hover:bg-slate-500 w-8 h-8 rounded-lg font-bold" data-id="${s.id}" data-action="minus">-</button>
              <span class="font-bold text-lg w-8 text-center">${s.qty}</span>
              <button class="qty-btn bg-slate-600 hover:bg-slate-500 w-8 h-8 rounded-lg font-bold" data-id="${s.id}" data-action="plus">+</button>
              <button class="remove-btn bg-red-600 hover:bg-red-700 px-3 py-1 rounded-lg font-bold text-sm" data-id="${s.id}">Remover</button>
            </div>
          </div>
        `;
      }).join('');

      totalEl.textContent = `R$ ${total.toFixed(2)}`;

      list.querySelectorAll('.qty-btn').forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.id;
          const action = btn.dataset.action;
          const service = state.selectedServices.find(s => s.id === id);
          
          if (action === 'plus') service.qty++;
          else if (action === 'minus' && service.qty > 1) service.qty--;
          
          renderSelectedServices();
        };
      });

      list.querySelectorAll('.remove-btn').forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.id;
          state.selectedServices = state.selectedServices.filter(s => s.id !== id);
          renderSelectedServices();
        };
      });
    }

    // Salvar Atendimento R√°pido
    document.getElementById('save-quick-btn').onclick = async () => {
      const prof = document.getElementById('quick-prof').value;
      const dateInput = document.getElementById('quick-date').value;
      const timeInput = document.getElementById('quick-time').value;
      
      if (!prof) {
        toast('Selecione um profissional!', 'error');
        return;
      }

      if (!dateInput) {
        toast('Selecione uma data!', 'error');
        return;
      }

      if (!timeInput) {
        toast('Selecione um hor√°rio!', 'error');
        return;
      }

      if (state.selectedServices.length === 0) {
        toast('Selecione pelo menos um servi√ßo!', 'error');
        return;
      }

      const btn = document.getElementById('save-quick-btn');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner mx-auto"></div>';

      let saved = 0;
      for (const service of state.selectedServices) {
        for (let i = 0; i < service.qty; i++) {
          const result = await apiAdd({
            data: `${dateInput}T${timeInput}:00`,
            tipo: prof,
            valor: service.value,
            categoria: 'atendimento',
            descricao: service.name
          });
          
          if (result.success) saved++;
        }
      }

      toast(`‚úÖ ${saved} atendimento(s) salvos!`);
      state.selectedServices = [];
      renderSelectedServices();
      
      btn.disabled = false;
      btn.textContent = 'üíæ SALVAR ATENDIMENTO';
      
      await loadData();
    };

    // Limpar Sele√ß√£o
    document.getElementById('clear-quick-btn').onclick = () => {
      state.selectedServices = [];
      renderSelectedServices();
    };

    // Render Lista de Profissionais
    function renderProfList() {
      const list = document.getElementById('prof-list');
      if (state.professionals.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-4">Nenhum colaborador cadastrado</p>';
        return;
      }

      list.innerHTML = state.professionals.map(p => `
        <div class="bg-slate-700 rounded-xl p-4 flex items-center justify-between">
          <div>
            <p class="font-bold text-lg">${p.name}</p>
            <p class="text-sm text-gray-400">Comiss√£o: ${p.commission}%</p>
          </div>
          <button class="del-prof-btn bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-bold" data-id="${p.id}">Excluir</button>
        </div>
      `).join('');

      list.querySelectorAll('.del-prof-btn').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          const prof = state.professionals.find(p => p.id === id);
          showModal(`Excluir ${prof.name}?`, async () => {
            const result = await apiDelete(id);
            if (result.success) {
              toast('Profissional exclu√≠do!');
              await loadData();
            }
          });
        };
      });
    }

    // Form Profissional
    document.getElementById('prof-form').onsubmit = async (e) => {
      e.preventDefault();
      const btn = e.target.querySelector('button');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner mx-auto"></div>';

      const name = document.getElementById('prof-name').value;
      const commission = document.getElementById('prof-commission').value;

      const result = await apiAdd({
        data: new Date().toISOString(),
        tipo: 'entrada',
        valor: parseFloat(commission),
        categoria: 'profissional',
        descricao: name
      });

      if (result.success) {
        toast('Colaborador adicionado!');
        e.target.reset();
        await loadData();
      }

      btn.disabled = false;
      btn.textContent = 'ADICIONAR';
    };

    // Render Lista de Servi√ßos
    function renderServiceList() {
      const list = document.getElementById('service-list');
      const count = document.getElementById('service-count');
      count.textContent = state.services.length;

      if (state.services.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-4">Nenhum servi√ßo cadastrado</p>';
        return;
      }

      list.innerHTML = state.services.map(s => `
        <div class="bg-slate-700 rounded-lg p-3 flex items-center justify-between">
          <div>
            <p class="font-bold">${s.name}</p>
            <p class="text-sm text-green-400">R$ ${s.value.toFixed(2)}</p>
          </div>
          <button class="del-service-btn bg-red-600 hover:bg-red-700 px-3 py-1 rounded-lg font-bold text-sm" data-id="${s.id}">Excluir</button>
        </div>
      `).join('');

      list.querySelectorAll('.del-service-btn').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          const service = state.services.find(s => s.id === id);
          showModal(`Excluir ${service.name}?`, async () => {
            const result = await apiDelete(id);
            if (result.success) {
              toast('Servi√ßo exclu√≠do!');
              await loadData();
            }
          });
        };
      });
    }

    // Form Servi√ßo
    document.getElementById('service-form').onsubmit = async (e) => {
      e.preventDefault();
      const btn = e.target.querySelector('button[type="submit"]');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner mx-auto"></div>';

      const name = document.getElementById('service-name').value;
      const value = parseFloat(document.getElementById('service-value').value);

      const result = await apiAdd({
        data: new Date().toISOString(),
        tipo: 'entrada',
        valor: value,
        categoria: 'servico',
        descricao: name
      });

      if (result.success) {
        toast('Servi√ßo cadastrado!');
        e.target.reset();
        await loadData();
      }

      btn.disabled = false;
      btn.textContent = 'CADASTRAR';
    };

    // Importar Servi√ßos
    document.getElementById('import-btn').onclick = async () => {
      const btn = document.getElementById('import-btn');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner mx-auto"></div>';

      const servicos = [
        { name: 'CORTE', value: 40.00 },
        { name: 'CABELO M√âDIO', value: 50.00 },
        { name: 'CORTE CARECA', value: 30.00 },
        { name: 'CORTE+SOBRANCELHA+BOTOX', value: 140.00 },
        { name: 'CORTE+SOBRANCELHA', value: 50.00 },
        { name: 'CORTE+PIGMENTO', value: 50.00 },
        { name: 'CORTE+PENTEADO+SOMB...', value: 80.00 },
        { name: 'CORTE+PENTEADO', value: 70.00 },
        { name: 'CORTE+BARBA+SOBRANCELHA+PIG', value: 100.00 },
        { name: 'CORTE+BARBA+PIGMENTO', value: 90.00 },
        { name: 'CORTE+BARBA', value: 80.00 },
        { name: 'CORTE+BARBA+SOBRANCELHA', value: 90.00 },
        { name: 'CORTE+BARBA+PENTEADO', value: 110.00 },
        { name: 'CORTE+BARBA+SOMB+PENTEADO', value: 120.00 },
        { name: 'CORTE+SOMBRANCELHA+BIGODE', value: 60.00 },
        { name: 'CORTE+SOMB+BIGODE+CAVANHA', value: 80.00 },
        { name: 'CORTE+SOMBR+PENTEADO', value: 80.00 },
        { name: 'BARBA+PEZINHO', value: 50.00 },
        { name: 'BARBA+SOBRANCELHA', value: 50.00 },
        { name: 'CORTE+PLATINADO', value: 130.00 },
        { name: 'CORTE+LUZES', value: 120.00 },
        { name: 'CORTE+ALIZANTE', value: 80.00 },
        { name: 'CORTE+ALIZANTE+SOBRANCELHA', value: 90.00 },
        { name: 'CORTE+ALIZANTE+PENTEADO', value: 110.00 },
        { name: 'CORTE+ALIZANTE+SOMBR...', value: 90.00 },
        { name: 'ALIZANTE+PEZINHO', value: 50.00 },
        { name: 'CORTE+BOTOX', value: 120.00 },
        { name: 'CORTE+PROGRESSIVA', value: 160.00 },
        { name: 'PEZINHO+SOMBRANCELHA', value: 20.00 },
        { name: 'CORTE+CAVANHAQUE', value: 70.00 },
        { name: 'PENTEADO+BARBA', value: 70.00 },
        { name: 'SOBRANCELHA+PIGMENTO', value: 20.00 },
        { name: 'SOBRANCELHA', value: 10.00 },
        { name: 'GEL', value: 15.00 },
        { name: 'POMADA', value: 20.00 },
        { name: 'PLATINADO', value: 130.00 },
        { name: 'PIGMENTO', value: 10.00 },
        { name: 'LUZES', value: 80.00 },
        { name: 'ALIZANTE', value: 40.00 },
        { name: 'PEZINHO', value: 10.00 },
        { name: 'PENTEADO', value: 30.00 },
        { name: 'BARBA', value: 40.00 },
        { name: 'CAVANHAQUE', value: 30.00 }
      ];

      let count = 0;
      for (const s of servicos) {
        const exists = state.services.find(existing => existing.name.toLowerCase() === s.name.toLowerCase());
        if (!exists) {
          const result = await apiAdd({
            data: new Date().toISOString(),
            tipo: 'entrada',
            valor: s.value,
            categoria: 'servico',
            descricao: s.name
          });
          if (result.success) count++;
        }
      }

      toast(`‚úÖ ${count} servi√ßos importados!`);
      btn.disabled = false;
      btn.textContent = 'üì• IMPORTAR SERVI√áOS PADR√ÉO';
      await loadData();
    };

    // Render Custos
    function renderCostList() {
      const list = document.getElementById('cost-list');
      if (state.costs.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-4">Nenhum custo registrado</p>';
        return;
      }

      const fixedCosts = state.costs.filter(c => c.costType === 'Fixo');
      const variableCosts = state.costs.filter(c => c.costType === 'Vari√°vel');

      let html = '';

      if (fixedCosts.length > 0) {
        html += '<div class="mb-4"><h4 class="text-sm font-bold text-green-400 mb-2">üí∞ CUSTOS FIXOS MENSAIS</h4>';
        html += fixedCosts.map(c => `
          <div class="bg-zinc-900 rounded-lg p-3 flex items-center justify-between mb-2 border-l-4 border-orange-500">
            <div>
              <p class="font-bold">${c.description} <span class="text-xs bg-orange-600 px-2 py-1 rounded-full ml-2">FIXO</span></p>
              <p class="text-sm text-gray-400">${c.category}</p>
              <p class="text-sm text-red-400 font-bold mt-1">R$ ${c.value.toFixed(2)} / m√™s</p>
            </div>
            <button class="del-cost-btn bg-red-600 hover:bg-red-700 px-3 py-1 rounded-lg font-bold text-sm" data-id="${c.id}">Excluir</button>
          </div>
        `).join('');
        html += '</div>';
      }

      if (variableCosts.length > 0) {
        html += '<div><h4 class="text-sm font-bold text-blue-400 mb-2">üìä CUSTOS VARI√ÅVEIS</h4>';
        html += variableCosts.slice(-15).reverse().map(c => `
          <div class="bg-zinc-900 rounded-lg p-3 flex items-center justify-between mb-2">
            <div>
              <p class="font-bold">${c.description}</p>
              <p class="text-sm text-gray-400">${c.category} ‚Ä¢ ${new Date(c.date).toLocaleDateString('pt-BR')}</p>
              <p class="text-sm text-red-400 font-bold mt-1">R$ ${c.value.toFixed(2)}</p>
            </div>
            <button class="del-cost-btn bg-red-600 hover:bg-red-700 px-3 py-1 rounded-lg font-bold text-sm" data-id="${c.id}">Excluir</button>
          </div>
        `).join('');
        html += '</div>';
      }

      list.innerHTML = html;

      list.querySelectorAll('.del-cost-btn').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          const cost = state.costs.find(c => c.id === id);
          showModal(`Excluir ${cost.description}?`, async () => {
            const result = await apiDelete(id);
            if (result.success) {
              toast('Custo exclu√≠do!');
              await loadData();
            }
          });
        };
      });
    }

    // Form Custo
    document.getElementById('cost-form').onsubmit = async (e) => {
      e.preventDefault();
      const btn = e.target.querySelector('button');
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner mx-auto"></div>';

      const date = document.getElementById('cost-date').value;
      const category = document.getElementById('cost-category').value;
      const desc = document.getElementById('cost-desc').value;
      const value = document.getElementById('cost-value').value;

      const result = await apiAdd({
        data: `${date}T00:00:00`,
        tipo: category,
        valor: parseFloat(value),
        categoria: 'custo_variavel',
        descricao: desc
      });

      if (result.success) {
        toast('Custo registrado!');
        e.target.reset();
        document.getElementById('cost-date').value = new Date().toISOString().split('T')[0];
        await loadData();
      }

      btn.disabled = false;
      btn.textContent = 'REGISTRAR';
    };

    // Atualizar Selects
    function updateSelects() {
      const quickProf = document.getElementById('quick-prof');
      const filterProf = document.getElementById('filter-prof');

      const profs = [{name: 'THIAGO'}, ...state.professionals];
      
      const quickValue = quickProf.value;
      quickProf.innerHTML = '<option value="">Selecione o profissional</option>' + 
        profs.map(p => `<option value="${p.name}">${p.name === 'THIAGO' ? 'üëë ' : ''}${p.name}</option>`).join('');
      if (quickValue) quickProf.value = quickValue;

      const filterValue = filterProf.value;
      filterProf.innerHTML = '<option value="">Todos</option>' + 
        profs.map(p => `<option value="${p.name}">${p.name}</option>`).join('');
      if (filterValue) filterProf.value = filterValue;
    }

    // Hist√≥rico
    function renderHistory() {
      const list = document.getElementById('history-list');
      const filterProf = document.getElementById('filter-prof').value;
      const filterStatus = document.getElementById('filter-status').value;
      const filterDate = document.getElementById('filter-date').value;
      const filterMonth = document.getElementById('filter-month').value;
      const selectAllBtn = document.getElementById('select-all-btn');
      const deleteSelectedBtn = document.getElementById('delete-selected-btn');

      let filtered = state.appointments;
      if (filterProf) filtered = filtered.filter(a => a.professionalName === filterProf);
      if (filterStatus) filtered = filtered.filter(a => a.status === filterStatus);
      if (filterDate) filtered = filtered.filter(a => a.date.split('T')[0] === filterDate);
      if (filterMonth) filtered = filtered.filter(a => a.month === filterMonth);

      if (filtered.length === 0) {
        list.innerHTML = '<p class="text-gray-400 text-center py-8">Nenhum atendimento encontrado</p>';
        selectAllBtn.classList.add('hidden');
        deleteSelectedBtn.classList.add('hidden');
        return;
      }

      selectAllBtn.classList.remove('hidden');

      list.innerHTML = filtered.reverse().map(a => {
        const isSelected = state.selectedForDeletion.has(a.id);
        return `
        <div class="card rounded-xl p-4 flex items-center gap-4 ${isSelected ? 'ring-2 ring-red-500' : ''}">
          <input type="checkbox" class="appt-checkbox w-5 h-5 rounded cursor-pointer" data-id="${a.id}" ${isSelected ? 'checked' : ''}>
          <div class="flex-1 grid grid-cols-2 md:grid-cols-6 gap-3 text-sm">
            <div>
              <p class="text-gray-400 text-xs">Servi√ßo</p>
              <p class="font-bold">${a.serviceName}</p>
            </div>
            <div>
              <p class="text-gray-400 text-xs">Profissional</p>
              <p class="font-bold">${a.professionalName}</p>
            </div>
            <div>
              <p class="text-gray-400 text-xs">Data</p>
              <p class="font-bold">${new Date(a.date).toLocaleDateString('pt-BR')}</p>
            </div>
            <div>
              <p class="text-gray-400 text-xs">Hor√°rio</p>
              <p class="font-bold">${a.time}</p>
            </div>
            <div>
              <p class="text-gray-400 text-xs">Valor</p>
              <p class="font-bold text-green-400">R$ ${a.value.toFixed(2)}</p>
            </div>
            <div>
              <p class="text-gray-400 text-xs">Status</p>
              <p class="font-bold ${a.status === 'Pago' ? 'text-green-400' : 'text-yellow-400'}">${a.status}</p>
            </div>
          </div>
          <button class="del-appt-btn bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-bold text-sm" data-id="${a.id}">Excluir</button>
        </div>
      `;
      }).join('');

      list.querySelectorAll('.appt-checkbox').forEach(checkbox => {
        checkbox.onchange = (e) => {
          const id = e.target.dataset.id;
          if (e.target.checked) {
            state.selectedForDeletion.add(id);
          } else {
            state.selectedForDeletion.delete(id);
          }
          updateDeleteButton();
        };
      });

      list.querySelectorAll('.del-appt-btn').forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          const appt = state.appointments.find(a => a.id === id);
          showModal(`Excluir atendimento de ${appt.serviceName}?`, async () => {
            const result = await apiDelete(id);
            if (result.isOk || result.success) {
              toast('Atendimento exclu√≠do!');
              state.selectedForDeletion.delete(id);
              await loadData();
              renderHistory();
            }
          });
        };
      });

      updateDeleteButton();
    }

    function updateDeleteButton() {
      const deleteBtn = document.getElementById('delete-selected-btn');
      const count = document.getElementById('selected-count');
      const selectedCount = state.selectedForDeletion.size;

      count.textContent = selectedCount;

      if (selectedCount > 0) {
        deleteBtn.classList.remove('hidden');
      } else {
        deleteBtn.classList.add('hidden');
      }
    }

    document.getElementById('select-all-btn').onclick = () => {
      const filterProf = document.getElementById('filter-prof').value;
      const filterStatus = document.getElementById('filter-status').value;

      let filtered = state.appointments;
      if (filterProf) filtered = filtered.filter(a => a.professionalName === filterProf);
      if (filterStatus) filtered = filtered.filter(a => a.status === filterStatus);

      const allSelected = filtered.every(a => state.selectedForDeletion.has(a.id));

      if (allSelected) {
        filtered.forEach(a => state.selectedForDeletion.delete(a.id));
      } else {
        filtered.forEach(a => state.selectedForDeletion.add(a.id));
      }

      renderHistory();
    };

    document.getElementById('delete-selected-btn').onclick = async () => {
      const count = state.selectedForDeletion.size;
      showModal(`Excluir ${count} atendimento(s) selecionado(s)?`, async () => {
        const btn = document.getElementById('delete-selected-btn');
        btn.disabled = true;
        btn.innerHTML = '<div class="spinner mx-auto"></div>';

        const idsToDelete = Array.from(state.selectedForDeletion);
        let deleted = 0;

        for (const id of idsToDelete) {
          const result = await apiDelete(id);
          if (result.success) deleted++;
        }

        state.selectedForDeletion.clear();
        toast(`‚úÖ ${deleted} atendimento(s) exclu√≠dos!`);
        
        btn.disabled = false;
        btn.innerHTML = 'üóëÔ∏è Excluir Selecionados (<span id="selected-count">0</span>)';
        await loadData();
        renderHistory();
      });
    };

    document.getElementById('filter-date').onchange = () => {
      state.selectedForDeletion.clear();
      renderHistory();
    };
    document.getElementById('filter-month').onchange = () => {
      state.selectedForDeletion.clear();
      renderHistory();
    };
    document.getElementById('filter-prof').onchange = () => {
      state.selectedForDeletion.clear();
      renderHistory();
    };
    document.getElementById('filter-status').onchange = () => {
      state.selectedForDeletion.clear();
      renderHistory();
    };

    // Relat√≥rios
    function renderReports() {
      const date = document.getElementById('report-date').value;
      const month = document.getElementById('report-month').value;
      const year = document.getElementById('report-year').value;

      const container = document.getElementById('reports-container');

      const paidAppts = state.appointments.filter(a => a.status === 'Pago');
      
      const dayAppts = date ? paidAppts.filter(a => a.date.split('T')[0] === date) : [];
      const monthAppts = month && year ? paidAppts.filter(a => a.month === month && a.year === year) : [];

      const ownerDay = dayAppts.filter(a => a.professionalName === 'THIAGO').reduce((sum, a) => sum + a.value, 0);
      const othersDay = dayAppts.filter(a => a.professionalName !== 'THIAGO').reduce((sum, a) => sum + (a.value * 0.5), 0);
      const ownerDayTotal = ownerDay + othersDay;

      const ownerMonth = monthAppts.filter(a => a.professionalName === 'THIAGO').reduce((sum, a) => sum + a.value, 0);
      const othersMonth = monthAppts.filter(a => a.professionalName !== 'THIAGO').reduce((sum, a) => sum + (a.value * 0.5), 0);
      const ownerMonthTotal = ownerMonth + othersMonth;

      const totalFat = monthAppts.reduce((sum, a) => sum + a.value, 0);

      const dayFaturamentoBruto = dayAppts.reduce((sum, a) => sum + a.value, 0);
      const monthLucroLiquido = totalFat;

      const today = new Date(date);
      const startOfWeek = new Date(today);
      startOfWeek.setDate(today.getDate() - today.getDay());
      const endOfWeek = new Date(startOfWeek);
      endOfWeek.setDate(startOfWeek.getDate() + 6);

      const weekAppts = paidAppts.filter(a => {
        const apptDate = new Date(a.date);
        return apptDate >= startOfWeek && apptDate <= endOfWeek && a.year === year && a.month === month;
      });

      const weekFaturamento = weekAppts.reduce((sum, a) => sum + a.value, 0);
      const weekQtdServicos = weekAppts.length;

      const serviceCount = {};
      monthAppts.forEach(a => {
        serviceCount[a.serviceName] = (serviceCount[a.serviceName] || 0) + 1;
      });
      const topService = Object.entries(serviceCount).sort((a, b) => b[1] - a[1])[0] || ['Nenhum', 0];

      const ticketMedioDia = dayAppts.length > 0 ? dayFaturamentoBruto / dayAppts.length : 0;
      const ticketMedioSemana = weekQtdServicos > 0 ? weekFaturamento / weekQtdServicos : 0;
      const ticketMedioMes = monthAppts.length > 0 ? totalFat / monthAppts.length : 0;

      const mediaDiaria = totalFat / 30;
      const statusDia = dayFaturamentoBruto >= mediaDiaria ? 'üü¢ BOM' : 'üî¥ ABAIXO';
      const statusSemana = weekFaturamento >= (mediaDiaria * 7) ? 'üü¢ BOA' : 'üî¥ ABAIXO';
      const statusMes = totalFat >= (mediaDiaria * 30) ? 'üü¢ BOM' : 'üî¥ ABAIXO';

      container.innerHTML = `
        ${state.showOwnerValues ? `
        <div class="card rounded-2xl p-6 mb-6">
          <h3 class="text-2xl font-bold text-yellow-400 mb-6">üëë THIAGO (Propriet√°rio)</h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h4 class="text-lg font-bold text-gray-300 mb-3">üìÖ DIA</h4>
              <div class="space-y-3">
                <div class="bg-zinc-900 rounded-xl p-4">
                  <p class="text-sm text-gray-400 mb-2">üí∞ Lucro Bruto</p>
                  <p class="text-2xl font-black text-blue-400">R$ ${dayFaturamentoBruto.toFixed(2)}</p>
                  <p class="text-xs text-gray-500 mt-2">‚úÇÔ∏è ${dayAppts.filter(a => a.professionalName === 'THIAGO').length} atendimentos diretos</p>
                </div>
              </div>
            </div>

            <div>
              <h4 class="text-lg font-bold text-gray-300 mb-3">üìä MENSAL</h4>
              <div class="space-y-3">
                <div class="bg-zinc-900 rounded-xl p-4">
                  <p class="text-sm text-gray-400 mb-2">üí∞ Lucro Bruto</p>
                  <p class="text-2xl font-black text-blue-400">R$ ${totalFat.toFixed(2)}</p>
                  <p class="text-xs text-gray-500 mt-2">‚úÇÔ∏è ${monthAppts.filter(a => a.professionalName === 'THIAGO').length} atendimentos diretos</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        ` : ''}

        <div class="card rounded-2xl p-6 mb-6">
          <h3 class="text-2xl font-bold text-green-400 mb-4">üë• Colaboradores</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            ${state.professionals.map(p => {
              const pDay = dayAppts.filter(a => a.professionalName === p.name).reduce((sum, a) => sum + (a.value * (p.commission / 100)), 0);
              const pMonth = monthAppts.filter(a => a.professionalName === p.name).reduce((sum, a) => sum + (a.value * (p.commission / 100)), 0);
              const pDayCount = dayAppts.filter(a => a.professionalName === p.name).length;
              const pMonthCount = monthAppts.filter(a => a.professionalName === p.name).length;
              return `
                <div class="bg-zinc-900 rounded-xl p-4">
                  <p class="font-bold text-lg mb-3">${p.name} <span class="text-xs text-gray-400">(${p.commission}%)</span></p>
                  <div class="space-y-2">
                    <div>
                      <p class="text-xs text-gray-400">Dia</p>
                      <p class="text-xl font-bold text-green-400">R$ ${pDay.toFixed(2)}</p>
                      <p class="text-xs text-gray-500">‚úÇÔ∏è ${pDayCount} atendimentos</p>
                    </div>
                    <div>
                      <p class="text-xs text-gray-400">M√™s</p>
                      <p class="text-xl font-bold text-blue-400">R$ ${pMonth.toFixed(2)}</p>
                      <p class="text-xs text-gray-500">‚úÇÔ∏è ${pMonthCount} atendimentos</p>
                    </div>
                  </div>
                </div>
              `;
            }).join('') || '<p class="text-gray-400 text-center py-4 col-span-full">Nenhum colaborador cadastrado</p>'}
          </div>
        </div>

        <div class="card rounded-2xl p-6">
          <h3 class="text-2xl font-bold text-green-400 mb-6">üìä An√°lise de Desempenho</h3>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-zinc-900 rounded-xl p-5">
              <h4 class="font-bold text-lg mb-4 text-gray-300">üéØ Status de Desempenho</h4>
              <div class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-slate-800 rounded-lg">
                  <span class="font-bold">Dia:</span>
                  <span class="font-black text-lg">${statusDia}</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-slate-800 rounded-lg">
                  <span class="font-bold">Semana:</span>
                  <span class="font-black text-lg">${statusSemana}</span>
                </div>
                <div class="flex items-center justify-between p-3 bg-slate-800 rounded-lg">
                  <span class="font-bold">M√™s:</span>
                  <span class="font-black text-lg">${statusMes}</span>
                </div>
              </div>
            </div>

            <div class="bg-zinc-900 rounded-xl p-5">
              <h4 class="font-bold text-lg mb-4 text-gray-300">üèÜ Servi√ßo Mais Vendido (M√™s)</h4>
              <div class="text-center py-4">
                <p class="text-3xl font-black text-green-400 mb-2">${topService[0]}</p>
                <p class="text-gray-400 text-sm">${topService[1]} atendimentos</p>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <div class="bg-zinc-900 rounded-xl p-5">
              <h4 class="font-bold text-sm mb-2 text-gray-400">üí≥ Ticket M√©dio (Dia)</h4>
              <p class="text-3xl font-black text-blue-400">R$ ${ticketMedioDia.toFixed(2)}</p>
            </div>

            <div class="bg-zinc-900 rounded-xl p-5">
              <h4 class="font-bold text-sm mb-2 text-gray-400">üí≥ Ticket M√©dio (Semana)</h4>
              <p class="text-3xl font-black text-purple-400">R$ ${ticketMedioSemana.toFixed(2)}</p>
            </div>

            <div class="bg-zinc-900 rounded-xl p-5">
              <h4 class="font-bold text-sm mb-2 text-gray-400">üí≥ Ticket M√©dio (M√™s)</h4>
              <p class="text-3xl font-black text-green-400">R$ ${ticketMedioMes.toFixed(2)}</p>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="bg-zinc-900 rounded-xl p-5">
              <h4 class="font-bold text-sm mb-2 text-gray-400">‚úÇÔ∏è Servi√ßos (Dia)</h4>
              <p class="text-3xl font-black text-blue-400">${dayAppts.length}</p>
              <p class="text-xs text-gray-500 mt-1">atendimentos</p>
            </div>

            <div class="bg-zinc-900 rounded-xl p-5">
              <h4 class="font-bold text-sm mb-2 text-gray-400">‚úÇÔ∏è Servi√ßos (Semana)</h4>
              <p class="text-3xl font-black text-purple-400">${weekQtdServicos}</p>
              <p class="text-xs text-gray-500 mt-1">atendimentos</p>
            </div>

            <div class="bg-zinc-900 rounded-xl p-5">
              <h4 class="font-bold text-sm mb-2 text-gray-400">‚úÇÔ∏è Servi√ßos (M√™s)</h4>
              <p class="text-3xl font-black text-green-400">${monthAppts.length}</p>
              <p class="text-xs text-gray-500 mt-1">atendimentos</p>
            </div>
          </div>
        </div>
      `;
    }

    document.getElementById('report-date').onchange = renderReports;
    document.getElementById('report-month').onchange = renderReports;
    document.getElementById('report-year').onchange = renderReports;

    document.getElementById('toggle-owner-btn').onclick = () => {
      state.showOwnerValues = !state.showOwnerValues;
      const icon = document.getElementById('toggle-icon');
      const text = document.getElementById('toggle-text');
      
      if (state.showOwnerValues) {
        icon.textContent = 'üëÅÔ∏è';
        text.textContent = 'Ocultar Propriet√°rio';
      } else {
        icon.textContent = 'üîí';
        text.textContent = 'Mostrar Propriet√°rio';
      }
      
      renderReports();
    };

    // Extrato
    function renderExtrato() {
      const year = document.getElementById('extrato-year').value;
      const month = document.getElementById('extrato-month').value;
      const container = document.getElementById('extrato-container');

      if (!year) {
        container.innerHTML = '<p class="text-gray-400 text-center py-8">Selecione um ano para visualizar o extrato</p>';
        return;
      }

      const paidAppts = state.appointments.filter(a => a.status === 'Pago');

      if (month) {
        const monthAppts = paidAppts.filter(a => a.month === month && a.year === year);

        const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 
                           'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
        
        const faturamento = monthAppts.reduce((sum, a) => sum + a.value, 0);

        const ownerRevenue = monthAppts.filter(a => a.professionalName === 'THIAGO').reduce((sum, a) => sum + a.value, 0);
        const collabRevenue = monthAppts.filter(a => a.professionalName !== 'THIAGO').reduce((sum, a) => sum + (a.value * 0.5), 0);
        const ownerTotal = ownerRevenue + collabRevenue;

        container.innerHTML = `
          <div class="card rounded-2xl p-6">
            <h3 class="text-2xl font-bold text-green-400 mb-6">üìÖ ${monthNames[parseInt(month) - 1]} ${year}</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <div class="bg-zinc-900 rounded-xl p-6">
                <p class="text-sm text-gray-400 mb-2">Faturamento Total</p>
                <p class="text-3xl font-black text-blue-400">R$ ${faturamento.toFixed(2)}</p>
              </div>
              <div class="bg-zinc-900 rounded-xl p-6">
                <p class="text-sm text-gray-400 mb-2">üëë Receita THIAGO</p>
                <p class="text-3xl font-black text-green-400">R$ ${ownerTotal.toFixed(2)}</p>
              </div>
            </div>
          </div>
        `;

      } else {
        const yearAppts = paidAppts.filter(a => a.year === year);

        const monthlyData = [];
        for (let m = 1; m <= 12; m++) {
          const monthStr = String(m).padStart(2, '0');
          const mAppts = yearAppts.filter(a => a.month === monthStr);

          const fat = mAppts.reduce((sum, a) => sum + a.value, 0);

          const ownerRev = mAppts.filter(a => a.professionalName === 'THIAGO').reduce((sum, a) => sum + a.value, 0);
          const collabRev = mAppts.filter(a => a.professionalName !== 'THIAGO').reduce((sum, a) => sum + (a.value * 0.5), 0);
          const ownerTot = ownerRev + collabRev;

          monthlyData.push({
            month: m,
            faturamento: fat,
            ownerReceita: ownerTot
          });
        }

        const totalFat = monthlyData.reduce((sum, m) => sum + m.faturamento, 0);
        const totalOwnerReceita = monthlyData.reduce((sum, m) => sum + m.ownerReceita, 0);

        const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];

        container.innerHTML = `
          <div class="card rounded-2xl p-6">
            <h3 class="text-2xl font-bold text-green-400 mb-6">üìÖ Extrato Anual ${year}</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              <div class="bg-zinc-900 rounded-xl p-6">
                <p class="text-sm text-gray-400 mb-2">Faturamento Anual</p>
                <p class="text-3xl font-black text-blue-400">R$ ${totalFat.toFixed(2)}</p>
              </div>
              <div class="bg-zinc-900 rounded-xl p-6">
                <p class="text-sm text-gray-400 mb-2">üëë Receita THIAGO</p>
                <p class="text-3xl font-black text-green-400">R$ ${totalOwnerReceita.toFixed(2)}</p>
              </div>
            </div>
          </div>

          <div class="card rounded-2xl p-6">
            <h3 class="text-xl font-bold text-green-400 mb-4">üìä Detalhamento Mensal</h3>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <thead class="bg-zinc-900">
                  <tr>
                    <th class="px-4 py-3 text-left">M√™s</th>
                    <th class="px-4 py-3 text-right">Faturamento</th>
                    <th class="px-4 py-3 text-right">üëë Receita THIAGO</th>
                  </tr>
                </thead>
                <tbody>
                  ${monthlyData.map((m, idx) => `
                    <tr class="border-t border-zinc-700 hover:bg-zinc-900/50">
                      <td class="px-4 py-3 font-bold">${monthNames[idx]}</td>
                      <td class="px-4 py-3 text-right text-blue-400">R$ ${m.faturamento.toFixed(2)}</td>
                      <td class="px-4 py-3 text-right font-bold text-green-400">R$ ${m.ownerReceita.toFixed(2)}</td>
                    </tr>
                  `).join('')}
                  <tr class="border-t-2 border-green-500 bg-zinc-900 font-bold">
                    <td class="px-4 py-3">TOTAL</td>
                    <td class="px-4 py-3 text-right text-blue-400">R$ ${totalFat.toFixed(2)}</td>
                    <td class="px-4 py-3 text-right text-green-400">R$ ${totalOwnerReceita.toFixed(2)}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        `;
      }
    }

    document.getElementById('extrato-year').onchange = renderExtrato;
    document.getElementById('extrato-month').onchange = renderExtrato;

    // Atualizar data e hora
    function updateHeaderDateTime() {
      const now = new Date();
      const dateStr = now.toLocaleDateString('pt-BR', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      const timeStr = now.toLocaleTimeString('pt-BR', { 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit'
      });
      
      document.getElementById('header-date').textContent = dateStr.toUpperCase();
      document.getElementById('header-time').textContent = timeStr;
    }

    // Init
    async function initApp() {
      await loadData();
    }
    
    const today = new Date().toISOString().split('T')[0];
    const now = new Date().toTimeString().slice(0, 5);
    document.getElementById('quick-date').value = today;
    document.getElementById('quick-time').value = now;
    document.getElementById('report-date').value = today;
    document.getElementById('report-month').value = String(new Date().getMonth() + 1).padStart(2, '0');
    document.getElementById('report-year').value = new Date().getFullYear();
    document.getElementById('extrato-year').value = new Date().getFullYear();
    document.getElementById('cost-date').value = today;
    document.getElementById('filter-date').value = today;

    updateHeaderDateTime();
    setInterval(updateHeaderDateTime, 1000);

    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bb2e2e87203f200',t:'MTc2Nzk1MDcxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
